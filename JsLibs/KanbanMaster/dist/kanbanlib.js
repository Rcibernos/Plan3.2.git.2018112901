"use strict";var _createClass=function(){function a(e,d){for(var c=0;c<d.length;c++){var b=d[c];b.enumerable=b.enumerable||false;b.configurable=true;if("value" in b){b.writable=true}Object.defineProperty(e,b.key,b)}}return function(b,c,d){if(c){a(b.prototype,c)}if(d){a(b,d)}return b}}();function _classCallCheck(b,a){if(!(b instanceof a)){throw new TypeError("Cannot call a class as a function")}}var KanbanGhostCard=function(){function d(h){_classCallCheck(this,d);this.board=h;this.lane=undefined;this.x=0;this.y=0;this.width=0;this.offsetX=0;this.offsetY=0;this.display="none";this.create()}_createClass(d,[{key:"create",value:function a(){this.html=document.createElement("ghost")}},{key:"grab",value:function b(h){this.html.innerHTML=h.html.innerHTML;this.width=h.grabWidth;this.height=h.grabHeight;this.offsetX=h.grabOffsetX;this.offsetY=h.grabOffsetY;this.setStyles()}},{key:"show",value:function g(){this.display="block";this.setStyles()}},{key:"hide",value:function c(){this.display="none";this.setStyles()}},{key:"move",value:function e(h,i){this.x=h;this.y=i;this.setStyles()}},{key:"setStyles",value:function f(){this.html.style.transform="translateX("+this.x+"px) translateY("+this.y+"px)";this.html.style.width=this.width+"px";this.html.style.left=this.offsetX+"px";this.html.style.top=this.offsetY+"px";this.html.style.display=this.display}}]);return d}();var KanbanBoard=function(){function h(p){_classCallCheck(this,h);this.selector=p;this.id=p;this.lanes=[];this.cards=[];this.heldCard=undefined;this.heldCardMoved=false;this.html={};this.create();this.createGhost();this.addListeners()}_createClass(h,[{key:"create",value:function d(){this.html.container=document.querySelector(this.selector);this.html.board=document.createElement("kanban");this.html.container.appendChild(this.html.board);this.html.cards=[]}},{key:"createGhost",value:function e(){this.ghost=new KanbanGhostCard(this.html.board);this.html.board.appendChild(this.ghost.html)}},{key:"addListeners",value:function c(){var p=this;window.addEventListener("pointerup",function(q){p.mouseUp()});window.addEventListener("pointermove",function(q){p.mouseMove(q.clientX,q.clientY)})}},{key:"addLane",value:function b(q){var p=this;this.lanes.push(q);q.onMouseEnterLane=function(r){p.mouseEnterLane(r)};this.html.board.appendChild(q.html.lane)}},{key:"addCard",value:function a(q,r){var p=this;this.cards.push(q);q.onMouseEnter=function(s){p.mouseEnterCard(s)};q.onMouseDown=function(s,u,v){var t=s.id.substring(3,s.id.indexOf("_LN_"));if($("#"+t).parents(".KanbanContainer.KBRO").length===0){p.mouseDownOnCard(s,u,v)}};this.putCardInLane(q.id,r)}},{},{key:"findLane",value:function g(q){var p=0;var r=0;while((p<this.lanes.length)&&(r===0)){if(this.lanes[p].id===q){r=1}else{p++}}if(r===1){return this.lanes[p]}else{return undefined}}},{key:"findCard",value:function f(p){var q=0;var r=0;while((q<this.cards.length)&&(r===0)){if(this.cards[q].id===p){r=1}else{q++}}if(r===1){return this.cards[q]}else{return undefined}}},{key:"putCardInLane",value:function o(p,q){this.ghost.lane=this.findLane(q);this.findLane(q).append(this.findCard(p))}},{key:"putCardAroundCard",value:function n(r,s){var p=this.findCard(r);var q=this.findCard(s);if(p.id===q.id){return}this.findLane(q.lane.id).appendCardAroundCard(p,q)}},{key:"mouseEnterLane",value:function k(p){if(this.heldCard){this.putCardInLane(this.heldCard.id,p.id)}}},{key:"mouseEnterCard",value:function j(p){if(this.heldCard){this.putCardAroundCard(this.heldCard.id,p.id)}}},{key:"mouseDownOnCard",value:function i(p){this.heldCard=p;this.heldCard.grab();this.ghost.grab(p)}},{key:"mouseUp",value:function m(){if(this.heldCard){this.heldCard.drop();this.ghost.hide();this.heldCard=undefined}}},{key:"mouseMove",value:function l(p,q){if(this.heldCard){if(!this.heldCard.moved){this.heldCard.hold();this.ghost.show()}this.ghost.move(p,q)}}}]);return h}();var KanbanCard=function(){function f(k,j,l){_classCallCheck(this,f);this.id=k;this.lane=undefined;this.content=j;this.template=l;this.html={};this.prevlane=undefined;this.create();this.listen()}_createClass(f,[{key:"create",value:function a(){this.html=document.createElement("card");this.html.id=this.id;this.html.innerHTML=this.template(this.content);this.html.className=this.content.css}},{key:"listen",value:function g(){var j=this;this.html.addEventListener("pointerenter",function(k){j.mouseenter(k)});this.html.addEventListener("pointerdown",function(k){j.mousedown(k)})}},{key:"grab",value:function d(){this.moved=false}},{key:"hold",value:function e(){this.moved=true;this.html.classList.add("held")}},{key:"drop",value:function c(){this.html.classList.remove("held");if(this.lane.id===this.prevlane.id){return}if(MoveCard(this)){this.prevlane.append(this)}}},{key:"mouseenter",value:function i(){this.onMouseEnter(this)}},{key:"mousedown",value:function h(l){var k=l.target.getBoundingClientRect();var j=this.html.getBoundingClientRect();this.grabWidth=j.width;this.grabHeight=j.height;this.grabOffsetX=-l.offsetX-(k.left-j.left);this.grabOffsetY=-l.offsetY-(k.top-j.top);this.prevlane=this.lane;this.onMouseDown(this)}},{key:"edit",value:function b(j){var k=this}}]);return f}();var KanbanLane=function(){function d(i,h,j,k){_classCallCheck(this,d);this.id=i;this.content=h;this.template=j;this.value=k;this.html={lane:undefined,title:undefined,cards:undefined};this.create();this.listen()}_createClass(d,[{key:"create",value:function c(){this.html.lane=document.createElement("lane");this.html.title=document.createElement("lane-title");this.html.cards=document.createElement("lane-cards");this.html.lane.id=this.id;this.html.title.innerHTML=this.template(this.content);this.html.lane.appendChild(this.html.title);this.html.lane.appendChild(this.html.cards)}},{key:"listen",value:function e(){var h=this;this.html.cards.addEventListener("pointerenter",function(i){h.mouseenter(i)});this.html.title.addEventListener("touch",function(i){h.toggle(i)})}},{key:"mouseenter",value:function f(h){this.onMouseEnterLane(this)}},{key:"toggle",value:function g(){this.html.lane.classList.toggle("collapse")}},{key:"append",value:function a(h){h.lane=this;if(!h.movedToCardAndLane){this.html.cards.appendChild(h.html)}h.movedToCardAndLane=false}},{key:"appendCardAroundCard",value:function b(h,i){h.lane=this;h.movedToCardAndLane=h.html.parentElement!==i.html.parentElement;if(!i.html.nextSibling&&!h.movedToCardAndLane){this.append(h);return}this.html.cards.insertBefore(h.html,i.html)}}]);return d}();function deleteCard(c,a){var b="KB_"+c.id.substring(1);confirmAndGoXEval("Se va a eliminar el registro. \u00BFDesea continuar?. La operaci\u00F3n no podr\u00E1 deshacerse","","","","","deleteCardAux("+b+",'"+a+"');","")}function deleteCardAux(f,c){var a=f.findCard(c);var d=false;var g=$("#"+a.id).parents(".KanbanContainer");var e=CreateFormDataAjax(g);e.append("idvalue",a.content.idvalue);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtool.asmx/KanbanDeleteCard",contentType:false,processData:false,data:e,dataType:"text xml ",async:false,success:function(h){res=Resd(h);res=$(res).children().first().text();if(res){d=true}},error:function(h){TrataErrAjax("AJ101",h)}});if(d){alert(res);return}var b=document.getElementById(c);b.parentNode.removeChild(b)}function EditCard(d,a){var e=1;var c=d.substring(3);var b=a.replace(d,"");var f=b.indexOf("CRD_");b=b.substring(f+4);$("#CAMPOFORM_KANBAN_HIDDENIDSEL_"+d).val(b);$("#CAMPOFORM_BTEDITAR_"+d).click()}function newCard(a,b){var c=b.parentElement.parentElement.id;$("#CAMPOFORM_BTANIADIR_"+c).click()}function MoveCard(card){var err=false;var res;var msjerror;var mykb=$("#"+card.id).parents(".KanbanContainer");var formData=CreateFormDataAjax(mykb);var kb=card.lane.id.substring(0,card.lane.id.indexOf("_LN"));if(!formData){return}if($("#"+card.id).parents(".kbclass").first().data("async")){eval($("#"+card.id).parents(".kbclass").first().data("async"))}$("#CAMPOFORM_KANBAN_HIDDENIDSEL_"+kb).val(card.content.idvalue);$("#CAMPOFORM_KANBAN_HIDDENIDGROUPSEL_"+kb).val(card.lane.value);if($("#CAMPOFORM_BTFORMMOVER_"+kb).length>0){$("#CAMPOFORM_BTFORMMOVER_"+kb).click();return(false)}formData.append("idvalue",card.content.idvalue);formData.append("valuegroup",card.lane.value);formData.append("group",$(mykb).data("group"));$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtool.asmx/KanbanChangeLane",contentType:false,processData:false,data:formData,dataType:"text xml ",async:false,success:function(r){res=Resd(r);res=$(res).children().first().text();res=JSON.parse(res);var ok=TratarObjResAjax(res);if(ok){if((res.Refresh===true)||(res.Refresh==="true")){$("[id$='CAMPOFORM_BTREFRESH_"+kb+"']").click()}}},error:function(xhr){msjerror="Error en ajax [KanbanChangeLane]: "+xhr.status+" "+xhr.responseText;TrataErrAjax("AJ102",xhr);err=true}});return(err)}function SaveCard(a){var c=a.content.id;a.content.text=$("#txtcardedit").val();$("#"+c).find("mycard-text").text(a.content.text);a.content.title=$("#txtcardeditTit").val();$("#"+c).find("mycard-title").text(a.content.title);var b="bg-"+a.content.status;$("#"+c).find("mycard-text").removeClass(b);a.content.status=$("#selPriority").val();b="bg-"+a.content.status;$("#"+c).find("mycard-text").addClass(b)}function CreateFormDataAjax(c){if($(c).length<1){return}var b=document.getElementById("HiddenCurrentValueFormXPage").value;var a=new FormData();a.append("idvsesion",b);a.append("nombrecontrol",$(c).data("ctrl"));a.append("nombreform",$(c).data("nbform"));a.append("idregistro",$(c).data("idreg"));return a};