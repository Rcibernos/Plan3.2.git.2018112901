Ajustada=0;AjustadaH=getScreenHeight();var ListaCampos;var ListaForms;function AjustarCapas(){if(Ajustada>1){Ajustada=0;return}Ajustada+=1;Centrar_VentanaModal("DivCapaModal");RealW=MaxOffsetWidth();RealH=MaxOffsetHeight();DimensionarCapaOpaca("DivCapaOpaca",RealW,RealH);var a=get_popup_position_scroll_info();if(!isNaN(a)){window.scrollTo(0,a)}HidePantallaEnEspera()}function ArbolSegunEstado(){}function MantenerScrollPosition(a){document.getElementById("INFO_SCROLL_POSITION").value=Scroll_Top_Value(a)}function PosicionarScroll(){ArbScrollMode=0;HidArbolScrollMode=document.getElementById("INFO_TREEVIEW_SCROLL_MODE");if(HidArbolScrollMode){ArbScrollMode=HidArbolScrollMode.value}if(ArbScrollMode==="1"){AuxScrollPosition=document.getElementById("INFO_SCROLL_POSITION").value;if(AuxScrollPosition>0){AuxArbol.scrollTop=AuxScrollPosition}}}function InitAutocompleteForm(txt,idvsesion,type,nbtabla,txtHijo){if(!idvsesion){idvsesion=document.getElementById("HiddenCurrentValueFormXPage").value}$(txt).autocomplete({source:function(request,callback){var searchParam=request.term;Autocompletesource_NewElem(searchParam,callback)},delay:500,autoFocus:true,minLength:1,select:function(event,ui){event.preventDefault();Autocompleteselect_NewElem(ui.item.value,ui.item.label)},change:function(event,ui){Autocompletechange_NewElem(ui,this.value)},response:function(event,ui){if((ui.content)&&(ui.content.length<1)){oldAlert("No se encuentran resultados");$(this).val("")}}}).data("ui-autocomplete")._renderItem=AutocompleteRender_NewElem;function Autocompletesource_NewElem(value,callback){var myobj=Autocompletesearch_NewElem(type,value);callback(myobj)}function Autocompletesearch_NewElem(type,value){var r;var ajxpath;var idvsesion=document.getElementById("HiddenCurrentValueFormXPage").value;if(type.startsWith("R")){var ParamAux={idvsesion:idvsesion,nbform:nbtabla,same:type.endsWith("1"),value:value};ajxpath="/ws/ajxtoolDesigner.asmx/CargarListaFormulariosMismaTabla"}else{var ParamAux={idvsesion:idvsesion,type:type,pattern:value,nbtabla:nbtabla};ajxpath="/ws/ajxtool.asmx/GetTableColumnsList"}var ParamJson=JSON.stringify(ParamAux);var path=cUtilUrlPathName;$.ajax({type:"POST",url:path+ajxpath,contentType:"application/json; charset=utf-8",data:ParamJson,dataType:"json",async:false,success:function(res){r=Resd(res)},error:function(xhr){alert("Error en ajax [Autocomplete]: "+xhr.status+" "+xhr.responseText)}});if(r){var myobj=eval("("+r+")");return myobj}}function Autocompletechange_NewElem(ui,value){if(!ui.item){if(value&&value!=""){var mysearch=Autocompletesearch_NewElem(type,value)}}}function Autocompleteselect_NewElem(value,label){$(txt).val(value);if(txtHijo){InitAutocompleteForm(txtHijo,idvsesion,"C",value,"")}}function AutocompleteRender_NewElem(ul,item){return $("<li>").append('<div style="z-index:2000;" class=" PWAutocompleteItem '+(item.active?"active":"error")+' ">'+item.label+"</div>").appendTo(ul)}}function CargarArbol(d){$("#cellArbol").html("");var a={filtro:d};var b=JSON.stringify(a);var c=cUtilUrlPathName;$.ajax({type:"POST",url:c+"/ws/ajxtoolDesigner.asmx/CargarTablasForm",contentType:"application/json; charset=utf-8",data:b,dataType:"json",async:false,success:ActualizarEstructurarArbolWeb,error:function(e){alert("Error en ajax [CargarTablasForm]: "+e.status+" "+e.responseText)}});OperacionesArbol();InsertarFiltro()}function ActualizarEstructurarArbolWeb(a){a=Resd(a);if(a){$("#cellArbol").html(a)}$(".ulNodoTabla>li>ul>li>span").click(function(){CargarFormularioVistaDiseno(this.innerText);$("head").find("title").text("Diseñador de formularios:"+this.innerText);CloseProps()});$(function(){$(".tdResizablee").resizable({handles:"e"})})}function InsertarFiltro(){var a=$("<div>Buscador: </div>)").attr({id:"divFiltro"});var b=$("<input>").attr({id:"InputFiltroArbol",title:"Busqueda de tablas/formularios",display:"block",onkeyup:"FiltrarArbolXKeyUp(event,this)",onchange:"FiltrarArbolXValue(this)","class":"PWTextBox"});$(".tdDivDisForm").before(a);$(a).append(b)}function FiltrarArbolXKeyUp(a,b){var c=document.all?a.keycode:a.which;if(c===13){StopEvent(a);CargarArbol(b.value);return false}}function FiltrarArbolXValue(a){CargarArbol(a.value)}function Redim(){}function OperacionesArbol(){$(".PWDtree li:has(ul)").addClass("parent_li").find(" > span").attr("title","Contraer nodo");$(".PWDtree li.parent_li > span").on("click",function(b){var a=$(this).parent("li.parent_li").find(" > ul > li");if(a.is(":visible")){a.hide();$(this).attr("title","Expandir nodo").find(" > img").attr("src","./images/default/ArbolSel.png")}else{a.show();$(this).attr("title","Expandir nodo").find(" > img").attr("src","./images/default/ArbolOpen.png")}})}function LimpiarSeleccion(){$(".PWArbolSeleccionado").removeClass("PWArbolSeleccionado")}function CargarFormulario(a){var b={nbForm:a};var c=JSON.stringify(b);ShowPantallaEnEspera();$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarForm",contentType:"application/json; charset=utf-8",data:c,dataType:"json",async:false,success:ActualizarForm,error:function(d){alert("Error en ajax [CargarForm]: "+d.status+" "+d.responseText)}});HidePantallaEnEspera()}function CargarFormularioVistaDiseno(a){var b={nbForm:a};var c=JSON.stringify(b);ShowPantallaEnEspera();$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarFormDiseno",contentType:"application/json; charset=utf-8",data:c,dataType:"json",async:false,success:ActualizarForm,error:function(d){alert("Error en ajax [CargarFormDiseno]: "+d.status+" "+d.responseText)}});ObtenerListacampos();HidePantallaEnEspera();$("#DisNbForm").text(a);$("#liDisDelForm").show()}function ActualizarForm(h){h=Resd(h);if(h){var i;$("#cellForm").html(h);if($("#hnoform").length>0){var d=$("#hnoform").data("name");var a=d.split(".");var e=a[0];var c=a[1];if(confirm("¿Desea crear el formulario "+d+"?")){$("#ui-id-selTabla").val(e);$("#ui-id-selId").val("ID");$("#ui-id-txtNameIntForm").val(c);$("#ui-id-txtNameExtForm").val(c);var j=$("#ui-id-selTabla").val();var b=$("#ui-id-selId").val();var g=$("#ui-id-txtNameIntForm").val();var f=$("#ui-id-txtNameExtForm").val();ShowNewFormDialog(false)}return}$(".PWDformLink").click(function(){CargarPropiedadesForm(this,0);OpenDivProps(true)});$(".PWDformLink").css("cursor","pointer");$(".PWDedLink").click(function(){CargarPropiedadesED(this,0);OpenDivProps(true)});$(".PWDedLink").css("cursor","pointer");$(".PWDCampoLink").click(function(){CargarPropiedadesCampo(this,0);OpenDivProps(true)});$(".PWDCampoLink").css("cursor","pointer");$(".PWDTabLink").click(function(){CargaPropiedadesTab(this,0);OpenDivProps(true)});$(".PWDTabLink").css("cursor","pointer");$(".PWDBloqueLink").click(function(){CargarPropiedadesBL(this,0);OpenDivProps(true)});$(".PWDBloqueLink").css("cursor","pointer");$(".PWDTipoDLink").click(function(){CargaPropiedadesTipoDato(this,0);OpenDivProps(true)});$(".PWDTipoDLink").css("cursor","pointer");$("#DivTreeTablesForm").hide();ActualizarBotonResponsive()}}function CargarPropiedadesForm(a,b){var d={IdE:$(a).data("objid")};var e=JSON.stringify(d);ShowPantallaEnEspera();LimpiarSeleccion();$(a).parent().addClass("PWArbolSeleccionado");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarPropForm",contentType:"application/json; charset=utf-8",data:e,dataType:"json",async:false,success:function(f){ActualizarProp(f,b)},error:function(f){alert("Error en ajax [CargarPropForm]: "+f.status+" "+f.responseText)}});HidePantallaEnEspera();var c=$(a).data("objid");if(!c){c=a.textContent}CargarModalProp(c,b)}function ActualizarProp(b,a){b=Resd(b);if(!b){$("#cellProp").html("");return}if(a==1){$("#cellProp").html(b)}else{$("#DivElemProp").html(b);CambiarIcoXML(true)}FormateaPropiedades()}function CargarPropiedadesED(a,b){var d={IdED:a.id};var e=JSON.stringify(d);ShowPantallaEnEspera();LimpiarSeleccion();$(a).parent().addClass("PWArbolSeleccionado");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarPropED",contentType:"application/json; charset=utf-8",data:e,dataType:"json",async:false,success:function(f){ActualizarPropED(f,b)},error:function(f){alert("Error en ajax [CargarPropiedadesED]: "+f.status+" "+f.responseText)}});HidePantallaEnEspera();var c=a.textContent;if(!c){c=a.id}CargarModalProp(c,b)}function ActualizarPropED(b,a){ActualizarProp(b,a)}function CargaPropiedadesTipoDato(a,b){var c={IdTipoDato:a.id};var d=JSON.stringify(c);ShowPantallaEnEspera();LimpiarSeleccion();$(a).parent().addClass("PWArbolSeleccionado");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarPropTipoDato",contentType:"application/json; charset=utf-8",data:d,dataType:"json",async:false,success:function(e){ActualizarPropTD(e,b)},error:function(e){alert("Error en ajax [CargarPropiedadesTipoDato]: "+e.status+" "+e.responseText)}});HidePantallaEnEspera();CargarModalProp(a.id,b)}function ActualizarPropTD(b,a){ActualizarProp(b,a)}function CargaPropiedadesTab(a,b){var c={IdTipoDato:a.id};var d=JSON.stringify(c);LimpiarSeleccion();ShowPantallaEnEspera();$(a).parent().addClass("PWArbolSeleccionado");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarPropTAB",contentType:"application/json; charset=utf-8",data:d,dataType:"json",async:false,success:function(e){ActualizarPropTAB(e,b)},error:function(e){alert("Error en ajax [CargarPropiedadesTAB]: "+e.status+" "+e.responseText)}});HidePantallaEnEspera();CargarModalProp(a.id,b)}function ActualizarPropTAB(b,a){ActualizarProp(b,a)}function CargarPropiedadesBL(a,b){if(!a.id){return}var c={IdTipoDato:a.id};var d=JSON.stringify(c);LimpiarSeleccion();ShowPantallaEnEspera();$(a).parent().addClass("PWArbolSeleccionado");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarPropBloque",contentType:"application/json; charset=utf-8",data:d,dataType:"json",async:false,success:function(e){ActualizarPropTAB(e,b)},error:function(e){alert("Error en ajax [CargarPropiedadesTAB]: "+e.status+" "+e.responseText)}});HidePantallaEnEspera();CargarModalProp(a.id,b)}function FormateaPropiedades(){$(".PWDprop").change(function(){changeProp(this);CambiarIcoXML(true)});$(".PWDprop.script").css({"max-width":"400px",height:"50px",overflow:"auto"});$(".PWDprop.script").click(function(){var a=$(this).parent().prev("td").text();var b=$(this).attr("msjayuda");a=a+$("#ui-id-1").text().replace("PROPIEDADES DE","");EditarScript(this,a,b);CambiarIcoXML(true)});$(".PWDprop.int").css("text-align","right");$(".PWDprop.int").keydown(function(a){-1!==$.inArray(a.keyCode,[46,8,9,27,13,110,190,109,189])||/65|67|86|88/.test(a.keyCode)&&(!0===a.ctrlKey||!0===a.metaKey)||35<=a.keyCode&&40>=a.keyCode||(a.shiftKey||48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<a.keyCode)&&a.preventDefault()})}function changeProp(a){var c=$("#WFDisFormTP").data("tp");var b=$("#WFDisFormTP").data("id");changePropAjax(a.id,c,b,a.value,false)}function changePropAjax(IdProp,aTP,aID,value,msg){var ParamAux={TpElem:aTP,IdElem:aID,IdProp:IdProp,val:value};var ParamJson=JSON.stringify(ParamAux);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/changeProp",contentType:"application/json; charset=utf-8",data:ParamJson,dataType:"json",async:false,success:function(r){r=Resd(r);if(r){eval(r)}CambiarIcoXML(true)},error:function(xhr){alert("Error en ajax [changeProp]: "+xhr.status+" "+xhr.responseText)}})}function CargarPropiedadesCampo(a,b){var c={IdCampo:a.id};var d=JSON.stringify(c);ShowPantallaEnEspera();LimpiarSeleccion();$(a).parent().addClass("PWArbolSeleccionado");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarPropCampo",contentType:"application/json; charset=utf-8",data:d,dataType:"json",async:false,success:function(e){ActualizarPropCampo(e,b)},error:function(e){alert("Error en ajax [CargarPropiedadesCampo]: "+e.status+" "+e.responseText)}});HidePantallaEnEspera();nbctrl=a.id;CargarModalProp(nbctrl,b)}function ActualizarPropCampo(b,a){ActualizarProp(b,a)}var alreadysave=true;function InitEditor(b){ace.require("ace/ext/language_tools");var a=ace.edit("editor");a.setShowPrintMargin(false);a.getSession().setUseWrapMode(true);a.setOptions({enableBasicAutocompletion:true,enableSnippets:true,enableLiveAutocompletion:true,fontSize:"14pt",fontFamily:"Courier New"});a.on("change",function(){alreadysave=false});alreadysave=true;return a}function EditarScript(b,g,i){var h=b.id.toUpperCase();var l=b.id.indexOf("_")+1;var a=b.id.substring(l).toUpperCase();var n=document.createElement("div");$(n).attr({id:"editor",css:{whitespace:"preline"},title:g});$("#DivCapaModal").append(n);b.value=b.value.trim();var e=InitEditor("");if(h=="SQL_COLUMNAS"){e.setReadOnly(true)}var o=(b.value.toUpperCase().indexOf("/*[TYPE=JSCRIPT]*/")==0);e.setValue(b.value,-1);$(n).dialog({classes:{"ui-dialog-titlebar":"PWcabecera_toolbar","ui-dialog-titlebar-close":"PWButton PWJqueryDialogClose"},autoOpen:true,modal:true,draggable:true,resizable:false,closeOnEscape:true,closeText:"Cerrar",width:1100,height:700,position:{my:"top",at:"top",of:window},buttons:[{text:"Eliminar","class":"PWButton PWJqueryDialog PWJqueryDialogErase",click:function(){if(confirm("¿Desea eliminar el cálculo?")){Eliminar(this,"",b)}},disabled:function(){return((b.value=="")||(h=="SQL_COLUMNAS"))}},{text:"Limpiar","class":"PWButton PWJqueryDialog PWJqueryDialogClean",click:function(){e.setValue("")}},{text:"Cancelar","class":"PWButton PWJqueryDialog PWJqueryDialogKO",click:function(){alreadysave=true;$(this).dialog("close")}},{text:"Guardar","class":"PWButton PWJqueryDialog PWJqueryDialogOk",click:function(){Guardar(this,e.getValue(),b)},disabled:function(){return(h=="SQL_COLUMNAS")}},],close:function(){if(!alreadysave){if(confirm("¿Desea guardar los cambios?")){Guardar(this,e.getValue(),b)}}e.destroy();e.container.parentNode.removeChild(e.container);$("#editor").remove();e.container=null;e.renderer=null;e=null},});var c=document.createElement("div");$(c).attr({id:"ui-id-divHeader-select","class":"ui-dialog-title ui-id-divHeader-select"});var f=document.createElement("span");$(f).attr({id:"ui-id-spamHeader-select","class":"ui-id-spamHeader-select",});if(i){i=JSON.parse(i)}$(f).html(i);var d=document.createElement("div");$(d).attr({id:"ui-id-div-seltypescript",style:"float:right"});var m=document.createElement("select");var k=document.createElement("option");var j=document.createElement("option");k.text="SQL";k.value=1;k.id="selScriptSQL";j.text="JScript";j.value=2;j.id="selScriptJS";m.add(k);m.add(j);$(m).attr({id:"ui-id-scripttype"});$(m).on("change",function(){CambiarTipoScript(this,b,e)});if(o){m.value=2}else{m.value=1}$(".ui-dialog-titlebar").after(c);$(c).append(f);$(c).append(d);$(d).append(m);if(o){e.getSession().setMode("ace/mode/PlanJS");e.setTheme("ace/theme/sqlserver");AddSnippets(e,"JS")}else{e.getSession().setMode("ace/mode/plan");e.setTheme("ace/theme/sqlserver");AddSnippets(e,"SQL")}}function CambiarTipoScript(c,a,b){AddSnippets(b,"");if((c.value==1)&&(a.value.toUpperCase().indexOf("/*[TYPE=JSCRIPT]*/")==0)){a.value=a.value.replace("[TYPE=JSCRIPT]","[type=sql]");a.value=a.value.replace("[type=jscript]","[type=sql]");b.getSession().setMode("ace/mode/plan");b.setValue(a.value,-1)}else{if(c.value==2){a.value=a.value.replace("[TYPE=SQL]","[type=jscript]");a.value=a.value.replace("[type=sql]","[type=jscript]");if(a.value.indexOf("/*[type=jscript]*/")!=0){a.value="/*[type=jscript]*/ \n"+a.value}b.getSession().setMode("ace/mode/PlanJS");b.setValue(a.value,-1)}}AddSnippets(b,c.value)}function Eliminar(c,d,a){var b=ace.edit("editor");b.setValue("");Guardar(c,d,a)}function Guardar(d,e,c){e=e.trim();ShowPantallaEnEspera();var h="";if(e!=c.value){var b=$("#WFDisFormTP").data("tp");var a=$("#WFDisFormTP").data("id");var f={TpElem:b,IdElem:a,IdProp:c.id,val:e};var g=JSON.stringify(f);$(c).addClass("PWModalSelected");$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/changeProp",contentType:"application/json; charset=utf-8",data:g,dataType:"json",async:false,success:function(i){AuxGuardar(i)},error:function(i){alert("Error en ajax [changeProp]: "+i.status+" "+i.responseText)}});$(c).removeClass("PWModalSelected")}HidePantallaEnEspera();alreadysave=true;$(d).dialog("close")}function AuxGuardar(b){var a=ace.edit("editor");$(".PWModalSelected").val(a.getValue())}function getTextForm(a){switch(a){case"CFDT_CONDICIONAL":return"SELECT 'Nombre Formulario'";break;case"CFDT_VALIDADOR":return"SELECT 'Mensaje de Error'";break;default:return"<br>"}}function ActualizarXML_Aux(){var a=$("#FormProps").find("span").data("objid");if(a==null){a=$(".principal").attr("nbform");if(a==null){return}}return ActualizarXMLform_Aux(a)}function ActualizarXMLform_Aux(a){var b={nbform:a};var c=JSON.stringify(b);ShowPantallaEnEspera();$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/ActualizarXML",contentType:"application/json; charset=utf-8",data:c,dataType:"json",async:false,success:function(d){d=Resd(d);if(d.value!==""){CambiarIcoXML("")}},error:function(d){alert("Error en ajax [ActualizarXML]: "+d.status+" "+d.responseText)}});HidePantallaEnEspera();return}function ActualizarXML(){ActualizarXML_Aux()}function ActualizarXML_(a){confirmAndGoXEval(a,"","","","","ActualizarXML_Aux()","")}function ActualizarXMLform(a,b){if(!b){b="¿Desea actualizar el esquema XML?"}confirmAndGoXEval(b,"","","","","ActualizarXMLform_Aux(nbform)","")}function CambiarIcoXML(a){if(a){$("#BarraPrincipal_ActualizarXML").css("background","url('./images/default/actualizar_esquemaXML-24-f.png') no-repeat scroll center center")}else{$("#BarraPrincipal_ActualizarXML").css("background","url('./images/fontawesome/actualizar_esquemaXML_b_hover.png') no-repeat scroll center center")}}function DisplayArbolBusqueda(){$("#DivTreeTablesForm").toggle()}function DisplayPropForm(b){var c;var a=$(".principal");if($(a).length!=0){c=$(a).attr("nbform")}else{c=$(".PWDformLink").data("objid")}if(!c){return}CargarPropiedades(0,c,b);if(b==0){$("#DivElemPopUp").on("click",function(){CloseProps();DisplayPropForm(1)})}}function DisplayPropCell(){var a=$(selSELECTED).attr("nbctrl");CargarModalProp(a)}function DisplayDisenar(){$("#DivTreeTablesForm").hide();var a=$(".principal").attr("nbform");if(a){return}a=$(".PWDformLink").data("objid");if(!a){CloseProps();return}CargarFormularioVistaDiseno(a)}function DisplayLista(){var a=$(".PWDformLink").data("objid");if(a){return}a=$(".principal").attr("nbform");if(!a){return}CargarFormulario(a)}function CargarModalProp(b,a){$(".PWDSelectorEditable").find(".dropdown-menu a").click(function(){var d=$(this).closest(".dropdown-menu").siblings("input").val();d+=" "+$(this).attr("data-value");$(this).closest(".dropdown-menu").siblings("input").val(d);var f=$(this).closest(".dropdown-menu").siblings("input").attr("id");var e=document.getElementById(f);changeProp(e)});if(a==0){$("#DivElemTitText").text(b);return}var c="PROPIEDADES DE <"+b+">";$("#cellProp").dialog({classes:{"ui-dialog-titlebar":"PWcabecera_toolbar","ui-dialog-titlebar-close":"PWButton PWJqueryDialogOkBox"},autoOpen:true,modal:true,draggable:true,resizable:false,closeOnEscape:true,closeText:"Cerrar",width:1024,height:700,title:c,position:{my:"top",at:"top",of:"html"},buttons:[],close:function(){CambiarIcoXML(true);if(b.indexOf(".")<0){b=""}$("#cellProp").empty();Refresh(b)}})}function ConvertToResponsive(e){var d=document.getElementById(e);var a=document.getElementById("HiddenCurrentValueFormXPage").value;var b;var c;if(d[posFinalResponsive].value=="False"){b=d[posNbform].value;c=d[posIdform].value;confirmAndGoXEval("Se va a convertir el formulario '"+b+"' a Responsive. Si acepta PlanDesigner se comportará de forma errática.","","","","","AuxConvertResponsive('"+b+"','"+c+"','"+a+"')","")}else{b=d[posNbform].value;c=d[posIdform].value;confirmAndGoXEval("Se va a revertir el formulario '"+b+"' a Propiedades Absolutas. Los cambios realizados en Responsive no se verán reflejados.","","","","","AuxConvertResponsive('"+b+"','"+c+"','"+a+"')","")}}function btnConvertResponsiveF(d,b){var c=$(".PWDformLink").text();if(!c){c=$(".principal").attr("nbform")}if(!c){return}var a=document.getElementById("HiddenCurrentValueFormXPage").value;confirmAndGoXEval(d,"","","","","AuxConvertResponsive('"+c+"','','"+a+"','"+b+"')","")}function AuxConvertResponsive(d,a,b,c){var g;var e={nbform:d,IdValue:a,idvsesion:b,mode:c};var f=JSON.stringify(e);ShowPantallaEnEspera();$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolResponsive.asmx/ConvertToResponsive",contentType:"application/json; charset=utf-8",data:f,dataType:"json",async:false,success:function(h){g=h},error:function(h){alert("Error en ajax [ConvertToResponsive]: "+h.status+" "+h.responseText)}});g=Resd(g);if(!g){showError("No se ha podido convertir a Responsive");return}CambiarIcoXML(true);HidePantallaEnEspera();Refresh(d)}function ActualizarBotonResponsive(){if($(".responsivestatus").length>0){if($(".responsivestatus.rev2pa").length>0){$("#BarraPrincipal_btnConvertResponsive").hide();$("#BarraPrincipal_btnPA2Responsive").hide();$("#BarraPrincipal_btnResponsive2PA").show();$("#BarraPrincipal_btnDisenarForm").show()}else{if($(".responsivestatus.rev2resp").length>0){$("#BarraPrincipal_btnConvertResponsive").show();$("#BarraPrincipal_btnPA2Responsive").show();$("#BarraPrincipal_btnResponsive2PA").hide();$("#BarraPrincipal_btnDisenarForm").hide()}else{$("#BarraPrincipal_btnConvertResponsive").show();$("#BarraPrincipal_btnPA2Responsive").hide();$("#BarraPrincipal_btnResponsive2PA").hide();$("#BarraPrincipal_btnDisenarForm").hide()}}$("#BarraPrincipal_ActualizarXML").show();$("#BarraPrincipal_VerXML").show();$("#BarraPrincipal_btnPropForm").show();$("#BarraPrincipal_btnCopyForm").show();$("#BarraPrincipal_btnBorrarForm").show();$("#BarraPrincipal_btnNuevoForm").show();$("#BarraPrincipal_btnBuscarForm").show();$("#BarraPrincipal_btnListaForm").show();$("#BarraPrincipal_btnRefreshform").show()}else{$("#BarraPrincipal_ActualizarXML").hide();$("#BarraPrincipal_VerXML").hide();$("#BarraPrincipal_btnCopyForm").hide();$("#BarraPrincipal_btnConvertResponsive").hide();$("#BarraPrincipal_btnPA2Responsive").hide();$("#BarraPrincipal_btnResponsive2PA").hide();$("#BarraPrincipal_btnPropForm").hide();$("#BarraPrincipal_btnBuscarForm").show();$("#BarraPrincipal_btnBorrarForm").hide();$("#BarraPrincipal_btnNuevoForm").show();$("#BarraPrincipal_btnDisenarForm").hide();$("#BarraPrincipal_btnListaForm").hide();$("#BarraPrincipal_btnRefreshform").hide()}}function CargarFormularioInicial(b){if(b){var a=$("body").attr("frminicial");if(!a){return}CargarFormularioVistaDiseno(a);CloseProps()}else{$("#cellForm").empty();$("#DisNbForm").empty();CargarArbol("");$("#DivTreeTablesForm").show();ActualizarBotonResponsive()}}function ObtenerListacampos(){var a=$(".PWDformLink").data("objid");if(!a){a=$(".principal").attr("nbform")}if(!a){return}var b={nbform:a};var c=JSON.stringify(b);var d=cUtilUrlPathName;$.ajax({type:"POST",url:d+"/ws/ajxtoolDesigner.asmx/CargarListaCamposEditor",contentType:"application/json; charset=utf-8",data:c,dataType:"json",async:false,success:function(e){ListaCampos=Resd(e)},error:function(e){alert("Error en ajax [CargarListaCamposForm]: "+e.status+" "+e.responseText)}})}function ObtenerListaforms(){$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarListaFormulariosEditor",contentType:"application/json; charset=utf-8",async:false,success:function(a){lforms=Resd(a)},error:function(a){alert("Error en ajax [CargarListaForms]: "+a.status+" "+a.responseText)}});return lforms}function AddSnippets(a,c){var d=ace.require("ace/snippets").snippetManager;var b=d.files["ace/mode/text"];if(b.snippets){d.unregister(b.snippets)}if(ListaCampos){switch(c){case"SQL":b.snippetText=ListaCampos[0];break;case"JS":b.snippetText=ListaCampos[1];break}}if(ListaForms){b.snippetText=b.snippetText+ListaForms}b.snippets=d.parseSnippetFile(b.snippetText,"ace/mode/text");d.register(b.snippets)}function ShowNewFormDialog(a){var d=document.getElementById("ui-id-selTabla");var c=document.getElementById("ui-id-selId");var b=document.getElementById("HiddenCurrentValueFormXPage").value;InitAutocompleteForm(d,b,"T","",c);$("#NewForm").attr("title","Nuevo Formulario");$("#NewForm").dialog({classes:{"ui-dialog-titlebar":"PWcabecera_toolbar","ui-dialog-titlebar-close":"PWButton PWJqueryDialogClose"},autoOpen:true,modal:true,draggable:true,resizable:false,closeOnEscape:true,closeText:"Cerrar",width:500,height:400,position:{my:"top",at:"top",of:window},buttons:[{text:"Cancelar","class":"PWButton PWJqueryDialog PWJqueryDialogCancel",click:function(){$(this).dialog("close")}},{text:"Crear","class":"PWButton PWJqueryDialog PWJqueryDialogOk",click:function(){var h=$("#ui-id-selTabla").val();var e=$("#ui-id-selId").val();var g=$("#ui-id-txtNameIntForm").val();var f=$("#ui-id-txtNameExtForm").val();if(h&&e&&g){if(!f){f=g}$(this).dialog("close");AddNewForm(h,e,g,f)}else{oldAlert("Faltan campos obligatorios")}}}],close:function(){},open:function(){if(a){$("#ui-id-selTabla").val("");$("#ui-id-selId").val("");$("#ui-id-txtNameIntForm").val("");$("#ui-id-txtNameExtForm").val("")}}})}function ShowCopyForm(){var c=document.getElementById("ui-id-NbFormOrigen");var b=$(".principal").attr("nbform");var a=document.getElementById("HiddenCurrentValueFormXPage").value;InitAutocompleteForm(c,a,"R1",b,"");$("#CopyForm").attr("title","Copiar formulario desde... (BETA)");$("#CopyForm").dialog({classes:{"ui-dialog-titlebar":"PWcabecera_toolbar","ui-dialog-titlebar-close":"PWButton PWJqueryDialogClose"},autoOpen:true,modal:true,draggable:true,resizable:false,closeOnEscape:true,closeText:"Cerrar",width:500,height:450,position:{my:"top",at:"top",of:window},buttons:[{text:"Cancelar","class":"PWButton PWJqueryDialog PWJqueryDialogCancel",click:function(){$(this).dialog("close")}},{text:"Crear","class":"PWButton PWJqueryDialog PWJqueryDialogOk",click:function(){var d=$("#ui-id-NbFormOrigen").val();if(d){if(CopyForm(d)){$(this).dialog("close")}}else{oldAlert("Seleccione formulario origen.")}}}],open:function(){$("#ui-id-NbFormOrigen").val("")}})}function CopyForm(d){var e=$(".principal").attr("nbform");var f=parseInt($("#ui-id-CopyPACtrl").val().toString());var a=parseInt($("#ui-id-CopyCalcCtrl").val().toString());var g=parseInt($("#ui-id-CopyPAForm").val().toString());var b=parseInt($("#ui-id-CopyCalcForm").val().toString());var c=document.getElementById("HiddenCurrentValueFormXPage").value;var h={nbformOrigen:d,nbFormDestino:e,PACampo:f,CalcCampo:a,PAForm:g,CalcForm:b,idvsesion:c};var i=JSON.stringify(h);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/Copyform",contentType:"application/json; charset=utf-8",data:i,dataType:"json",async:false,success:function(j){j=Resd(j);if(j){alert(j)}else{Refresh();return true}},error:function(j){alert("Error en ajax [CopyForm]: "+j.status+" "+j.responseText)}});return false}function AddNewElement(c,b,a,f){if(!b){b=document.getElementById("HiddenCurrentValueFormXPage").value}var d={nbelem:c,idvsesion:b,idbloque:a,type:parseInt(f)};var e=JSON.stringify(d);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/AddNewElem",contentType:"application/json; charset=utf-8",data:e,dataType:"json",async:false,success:function(g){g=Resd(g);if((g.indexOf("ERROR:",0)!==0)||(!g)){if(f===typefrm){Refresh(g)}else{if((f!==typeCtrl)&&(f!==typeBL)){CargarPropiedadesModal(f,g);Refresh()}else{Refresh();ResetValues()}}CambiarIcoXML(true)}else{if(g){showError(g)}}},error:function(g){alert("Error en ajax [AddElement]: "+g.status+" "+g.responseText)}})}function DeleteElement(b,a){confirmAndGoXEval("¿Desea borrar el elemento seleccionado?","","","","","DeleteElement_Aux('"+b+"','"+a+"')","")}function DeleteElement_Aux(f,a){var c=false;var b=document.getElementById("HiddenCurrentValueFormXPage").value;var d={idvsesion:b,idelem:a,type:parseInt(f)};var e=JSON.stringify(d);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/DeleteElem",contentType:"application/json; charset=utf-8",data:e,dataType:"json",async:false,success:function(g){g=Resd(g);if(g==true){c=true;CambiarIcoXML(true)}else{alert("Error: El elemento no pudo ser eliminado.")}},error:function(g){alert("Error en ajax [DeleteElem]: "+g.status+" "+g.responseText)}});if((f==typefrm)&&c){Refresh("reset")}else{Refresh()}}function AddNewForm(e,c,d,b){var a=[e,c,d,b].join("|");AddNewElement(a,"","",typefrm);CargarArbol("")}function DeleteForm(){var a=$(".PWDformLink").data("objid");if(!a){a=$(".principal").attr("nbform")}if(!a){return}DeleteElement(typefrm,a)}function ShowNewCtrlDialog(b){var a=$(".principal").attr("nbform");$("#NewCtrl").attr("title","Nuevo Campo");ResetValues();ReloadDataTypes();$("#NewCtrl").dialog({classes:{"ui-dialog-titlebar":"PWcabecera_toolbar","ui-dialog-titlebar-close":"PWButton PWJqueryDialogClose"},autoOpen:true,modal:true,draggable:true,resizable:false,closeOnEscape:true,closeText:"Cerrar",width:800,height:400,position:{my:"top",at:"top",of:window},buttons:[{text:"Cancelar","class":"PWButton PWJqueryDialog PWJqueryDialogCancel",click:function(){$(this).dialog("close")}},{text:"Crear","class":"PWButton PWJqueryDialog PWJqueryDialogOk",click:function(){var c=$("#ui-val-CampoExistente").val();var d=$("#ui-id-NbCampo").val();if(!d){return}var k=$("#ui-id-TipoCampo").val();var j=$("#ui-val-TablaExistente").prop("checked");if(c=="3"){f=$("#ui-sel-NbCampo").children("option[value="+d+"]").attr("nbform")}else{var f=$("#ui-id-NbTabla").val()}var i=$("#ui-id-subtipo").val();var l=$("#ui-id-Titulo").val();var h=$("#ui-val-ReadOnly").prop("checked");var g=$("#ui-val-Obligatorio").prop("checked");var e=[c,d,k,j,f,i,l,h,g].join("*");AddNewElement(e,"",b,typeCtrl)}}],})}function ReloadDataTypes(){var a=document.getElementById("HiddenCurrentValueFormXPage").value;var b={idvsesion:a};var c=JSON.stringify(b);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarListaTipos",contentType:"application/json; charset=utf-8",data:c,dataType:"json",async:false,success:function(d){lista=Resd(d)},error:function(d){alert("Error en ajax [CargarListaTipos]:"+d.status+" "+d.responseText)}});if((lista)&&(lista.length>0)){$("#ui-id-TipoCampo").empty();$("#ui-id-TipoCampo").append("<option value='' typedb='null'> </option>");lista.forEach(function(d){$("#ui-id-TipoCampo").append("<option value='"+d[0]+"' typedb='"+d[2]+"'>"+d[1]+"</option>")})}}function LoadExistField(){var a=document.getElementById("HiddenCurrentValueFormXPage").value;var b=$(".principal").attr("nbform");var c={idvsesion:a,nbform:b};var d=JSON.stringify(c);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarCampoExistente",contentType:"application/json; charset=utf-8",data:d,dataType:"json",async:false,success:function(e){lista=Resd(e)},error:function(e){alert("Error en ajax [CargarCampoExistente]:"+e.status+" "+e.responseText)}});$("#ui-sel-NbCampo").empty();if((lista)&&(lista.length>0)){$("#ui-sel-NbCampo").append("<option value='' typedb='null' nbform='null'> </option>");lista.forEach(function(e){$("#ui-sel-NbCampo").append("<option value='"+e[1]+"' typedb='"+e[4]+"' nbform='"+e[0]+"' title='"+e[2]+"' subtipo='"+e[5]+"'>"+e[1]+" - "+e[2]+"\t["+e[0]+"]\t("+e[3]+")</option>")})}}function LoadExistColumn(nbform){var idvsesion=document.getElementById("HiddenCurrentValueFormXPage").value;var ParamAux={idvsesion:idvsesion,nbform:nbform};var ParamJson=JSON.stringify(ParamAux);$.ajax({type:"POST",url:cUtilUrlPathName+"/ws/ajxtoolDesigner.asmx/CargarColumnaNoExistente",contentType:"application/json; charset=utf-8",data:ParamJson,dataType:"json",async:false,success:function(res){lista=Resd(res)},error:function(xhr){alert("Error en ajax [CargarCampoExistente]:"+xhr.status+" "+xhr.responseText)}});if((lista)&&(lista.length>0)){$("#ui-sel-NbCampo").empty();$("#ui-sel-NbCampo").append("<option value='' typedb='null' nbform='null'> </option>");var myobj=eval(lista);myobj.forEach(function(item){$("#ui-sel-NbCampo").append("<option value='"+item.value+"' typedb='"+item.type+"'>"+item.label+"</option>")})}}function UpdateAutoComplete(f,e){if(e=="F"){switch(parseInt(f.value)){case 3:$("#ui-id-TipoCampo").prop("disabled",true);$("#ui-id-TipoCampo").removeClass("PWTextBoxObligatorio");$("#ui-id-subtipo").prop("disabled",true);$("#ui-id-NbTabla").prop("disabled",true);try{$("#ui-sel-NbCampo").autocomplete("option","disabled")}catch(a){var b=0}$("#ui-id-NbCampo").hide();$("#ui-sel-NbCampo").show();$("#ui-div-TabForm").hide();LoadExistField();break;case 2:ResetValues();var g=document.getElementById("ui-id-NbCampo");var d=$(".principal").attr("nbform");try{$("#ui-sel-NbCampo").autocomplete("option","disabled")}catch(a){var b=0}$("#ui-id-NbCampo").hide();$("#ui-sel-NbCampo").show();$("#ui-div-TabForm").hide();LoadExistColumn(d);break;default:ResetValues();break}}else{if(e=="T"){if(f.checked){$("#ui-div-TabExistente").show();$("#ui-id-NbTabla").prop("disabled",false);var g=document.getElementById("ui-id-NbTabla");InitAutocompleteForm(g,"","T","","")}else{$("#ui-div-TabExistente").hide()}}else{if(e.startsWith("R")){var c=$(".principal").attr("nbform");var h=document.getElementById("ui-id-NbFormOrigen");InitAutocompleteForm(h,"","R"+f.value,c,"")}}}}function EnableProps(a){switch(a.value){case"1":$("#ui-div-TabForm").hide();$("#ui-div-subtipo").show();$("#ui-txt-subtipo").text("Num.Caracteres");$("#ui-id-subtipo").val("255");break;case"3":$("#ui-div-TabForm").hide();$("#ui-div-subtipo").show();$("#ui-txt-subtipo").text("Num.Decimales");$("#ui-id-subtipo").val("2");break;case"106":$("#ui-div-subtipo").hide();$("#ui-id-subtipo").val("");$("#ui-div-TabForm").show();break;default:$("#ui-div-subtipo").hide();$("#ui-id-subtipo").val("");$("#ui-div-TabForm").hide()}}function ResetValues(){$("#ui-id-NbCampo").show();$("#ui-id-NbCampo").val("");$("#ui-sel-NbCampo").hide();$("#ui-sel-NbCampo").val("");try{$("#ui-sel-NbCampo").autocomplete("option","disabled")}catch(a){var b=0}$("#ui-id-Titulo").val("");$("#ui-id-Titulo").prop("disabled",false);$("#ui-div-TabForm").hide();$("#ui-val-TablaExistente").prop("checked",false);$("#ui-id-NbTabla").val("");$("#ui-id-TipoCampo").val("");$("#ui-id-TipoCampo").addClass("PWTextBoxObligatorio");$("#ui-id-TipoCampo").prop("disabled",false);$("#ui-div-subtipo").hide();$("#ui-id-subtipo").val("");$("#ui-id-subtipo").prop("disabled",false);$("#ui-val-Readonly").prop("checked",false);$("#ui-val-Obligatorio").prop("checked",false)}function LoadInfo(b){var a=1;var d=$(b).children("option[value='"+b.value+"']").attr("typedb");var e=$(b).children("option[value='"+b.value+"']").attr("title");var c=$(b).children("option[value='"+b.value+"']").attr("subtipo");$("#ui-id-NbCampo").val(b.value);$("#ui-id-TipoCampo").val(d);$("#ui-id-Titulo").val(e);$("#ui-id-subtipo").val(c)}function FormatNameCol(a){if(!a){return}var b=a.value;b=b.replace(/[ÁÂÄÀ]/g,"A");b=b.replace(/[áàäâ]/g,"a");b=b.replace(/[ÉÊËÈ]/g,"E");b=b.replace(/[éèëê]/g,"e");b=b.replace(/[ÍÎÌÏ]/g,"I");b=b.replace(/[íìïî]/g,"i");b=b.replace(/[ÓÒÖÔ]/g,"O");b=b.replace(/[óòöô]/g,"o");b=b.replace(/[ÜÙÛÜ]/g,"U");b=b.replace(/[úùüû]/g,"u");if((b.length==1)&&(b.match(/[^a-zA-Z]/g))){b=b.replace(/[^a-zA-Z]/g,"")}if(b.match(/[^a-zA-Z0-9_]/g)){b=b.replace(/[^a-zA-Z0-9_]/g,"")}return b}function ShowXMLCode(){var c=$(".principal").attr("nbform");var a=document.getElementById("HiddenCurrentValueFormXPage").value;var d={idvsesion:a};var e=JSON.stringify(d);var f=cUtilUrlPathName;var b="";ActualizarXML();$.ajax({type:"POST",url:f+"/ws/ajxtoolDesigner.asmx/LeerXML",contentType:"application/json; charset=utf-8",data:e,dataType:"json",async:false,success:function(g){b=Resd(g);if(b){if(b.substring(0,1)=="/"){window.open("."+b)}else{alert(b)}}},error:function(g){alert("Error en ajax [CargarTablasForm]: "+g.status+" "+g.responseText)}})};