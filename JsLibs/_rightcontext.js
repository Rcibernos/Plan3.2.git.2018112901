var RightContext={TYPE_MENU:0,TYPE_TEXT:1,TYPE_TEXT_EXT:2,TYPE_SEPERATOR:3,TYPE_ATTRIBUTES:4,menuTriggerEvent:"RIGHT",mousePos:{x:0,y:0},rightOffset:5,allowedContexts:["a","div","span","input","tr"],menuCollection:new Object(),contextMenu:null,isShowing:false,abortKill:false,images:new Object(),req:null,initialize:function(){this.attachContextEvents()},addMenu:function(b,a){this.menuCollection[b]=a},getMenu:function(a){return this.menuCollection[a]},attachContextEvents:function(){var b,c;for(var a=0;a<this.allowedContexts.length;a++){tags=document.getElementsByTagName(this.allowedContexts[a]);for(e=0;e<tags.length;e++){c=tags[e];b=c.getAttribute("context");if(b!=null&&b!="undefined"){this.bindEvent("mousemove",tags[e],function(d){return RightContext.locateMousePos(d)});if(this.menuTriggerEvent=="RIGHT"){tags[e].oncontextmenu=function(){return RightContext.render(this)};tags[e].onmouseout=function(d){setTimeout("RightContext.killMenu()",500)}}else{if(this.menuTriggerEvent=="LEFT"){tags[e].onclick=function(d){RightContext.killBubble(d);return RightContext.render(this)}}else{if(this.menuTriggerEvent=="MOVE"){if(!document.all){this.bindEvent("mouseover",tags[e],function(d){RightContext.locateMousePos(d);return RightContext.render(this)});this.bindEvent("mouseout",tags[e],function(d){setTimeout("RightContext.killMenu()",500)})}else{tags[e].onmouseover=function(d){RightContext.locateMousePos(d);return RightContext.render(this)};tags[e].onmouseout=function(d){setTimeout("RightContext.killMenu()",500)}}}}}}}}},killBubble:function(a){if(!a){var a=window.event}a.cancelBubble=true;if(a.stopPropagation){a.stopPropagation()}},bindEvent:function(c,d,a,b){if(!b){b=false}if(d.addEventListener){d.addEventListener(c,a,b)}else{if(d.attachEvent){d.attachEvent("on"+c,a)}}},render:function(b,f){var j,i;var f=f||b.getAttribute("context");var h=this.getMenu(f);var a=h.attributes.split(",");var c=h.items;var g=this.buildAttributeMap(a,b);this.killMenu();this.buildMenu(b);tbl=document.createElement("TABLE");tbl.id="rcRightContextTable";tbl.style.zIndex=5000;for(var d=0;d<c.length;d++){switch(c[d]["type"]){case this.TYPE_MENU:if(this.isDisplayed(c[d],g)){this.addMenuItem(c[d],g,tbl)}break;case this.TYPE_TEXT:text=this.transform(c[d]["text"],g);cell=this.addTableCell(tbl,"rcMenuItemText",text);break;case this.TYPE_TEXT_EXT:cell=this.addTableCell(tbl,"rcMenuItemTextExt");j=this.transform(c[d]["url"],g);this.request(j,function(){if(RightContext.req.readyState==4&&RightContext.req.status==200){cell.innerHTML=RightContext.req.responseText}});break;case this.TYPE_SEPERATOR:cell=this.addTableCell(tbl);cell.appendChild(this.getSeparator());break;default:break}}this.contextMenu.appendChild(tbl);this.repositionMenu();if(this.menuTriggerEvent=="MOVE"){this.bindEvent("mouseout",this.contextMenu,function(k){RightContext.abortKill=false;setTimeout("RightContext.killMenu()",500)});this.bindEvent("mouseover",this.contextMenu,function(k){RightContext.abortKill=true})}else{if(this.menuTriggerEvent=="LEFT"||this.menuTriggerEvent=="RIGHT"){this.bindEvent("click",document.body,function(k){setTimeout("RightContext.killMenu();",300)},false);this.bindEvent("mouseout",this.contextMenu,function(k){RightContext.abortKill=false;setTimeout("RightContext.killMenu()",500)});this.bindEvent("mouseover",this.contextMenu,function(k){RightContext.abortKill=true})}}this.isShowing=true;return false},isDisplayed:function(a,b){var d,c;var f=true;if(a.requires!=null&&a.requires!="undefined"){d=a.requires[0];c=a.requires[1];if(b[d]!=null&&b[d]!="undefined"){if(b[d]!=c){f=false}}else{f=false}}return f},repositionMenu:function(){var b=this.findPosition(this.contextMenu);var a=this.getDimensions(this.contextMenu);var c=window.innerHeight||document.body.clientHeight;var d=window.innerWidth||document.body.clientWidth;if(b.y+a.height>c-30){this.position(this.contextMenu,b.x,b.y-a.height);b=this.findPosition(this.contextMenu)}if(b.x+a.width>d-30){this.position(this.contextMenu,b.x-a.width,b.y)}},getSeparator:function(){var a=document.createElement("HR");a.className="rcMenuSeparator";return a},addTableCell:function(c,a,b){row=c.insertRow(-1);cell=row.insertCell(0);if(a){cell.className=a;if(b){cell.innerHTML=b}}return cell},addMenuItem:function(item,objMap,tbl){var title=this.transform(item.text,objMap);var url,frame,img,imgAlign,itemSrc,tmp,itemAction;var cell=this.addTableCell(tbl,"rcMenuItem",title);cell.style.cursor=document.all?"hand":"pointer";this.bindEvent("mouseover",cell,function(e){this.className="rcMenuItemHover"});this.bindEvent("mouseout",cell,function(e){this.className="rcMenuItem"});if(item.image!=null&&item.image!="undefined"){imgAlign=(item.align!=null&&item.align!="undefined")?item.align:"absmiddle";if(this.images[item.image]!=null&&this.images[item.image]!="undefined"){img=this.images[item.image]}else{img=this.loadImage(item.image)}img.align=imgAlign;cell.insertBefore(this.images[item.image],cell.childNodes[0])}if(item.url!=null&&item.url!="undefined"){url=this.transform(item.url,objMap);frame=false;if(item.frame!=null&&item.frame!="undefined"){frame=item.frame}cell.onclick=function(){RightContext.redirect(url,frame)}}else{itemAction=item.onclick;try{itemSrc=item.onclick.toString();if(itemSrc.indexOf("[")>-1){itemSrc=this.transform(itemSrc,objMap);if(document.all){eval("itemAction = "+itemSrc)}else{itemAction=eval(itemSrc)}}}catch(e){}cell.onclick=itemAction}},transform:function(b,a){var d,c;d=b;for(p in a){c="["+p+"]";d=d.replace(c,a[p])}return d},getMenuAttributeArray:function(b){for(var a=0;a<b.length;a++){if(b[a].type==this.TYPE_ATTRIBUTES){return b[a]["attributes"].split(",")}}return new Array(0)},buildAttributeMap:function(c,f){var g,h;var d=new Object();for(var b=0;b<c.length;b++){g=c[b];h=f.getAttribute(c[b]);if(typeof h!="undefined"){d[g]=h}}return d},findPosition:function(b){var a=0;var c=0;if(b.offsetParent){a=b.offsetLeft;c=b.offsetTop;while(b=b.offsetParent){a+=b.offsetLeft;c+=b.offsetTop}}return{x:a,y:c}},getDimensions:function(a){var b=a.style;var g=b.visibility;var f=b.position;var c=b.display;var h=a.clientWidth;var d=a.clientHeight;b.display=c;b.position=f;b.visibility=g;return{width:h,height:d}},position:function(a,b,c){a.style.left=b+"px";a.style.top=c+"px"},buildMenu:function(b){var c,a,d;this.contextMenu=document.createElement("DIV");this.contextMenu.id="rcRightContext";this.contextMenu.className="rcMenuContainer";c=this.findPosition(b);a=this.getDimensions(b);this.position(this.contextMenu,this.mousePos.x+this.rightOffset,c.y+a.height);if(this.menuTriggerEvent=="RIGHT"){this.contextMenu.oncontextmenu=function(){return false}}document.body.appendChild(this.contextMenu)},killMenu:function(){if(!this.abortKill&&this.isShowing){try{rc=this.contextMenu;document.body.removeChild(rc)}catch(a){}this.contextMenu=null;this.isShowing=false;this.abortKill=false}},locateMousePos:function(a){var b=0,c=0;if(a==null){a=window.event}if(a.pageX||a.pageY){b=a.pageX;c=a.pageY}else{if(a.clientX||a.clientY){if(document.documentElement.scrollTop){b=a.clientX+document.documentElement.scrollLeft;c=a.clientY+document.documentElement.scrollTop}else{b=a.clientX+document.body.scrollLeft;c=a.clientY+document.body.scrollTop}}}this.mousePos={x:b,y:c}},redirect:function(b,a){if(!a){document.location=b}else{if(a=="_blank"){w=window.open(b,"w")}else{window.frames[a].document.location=b}}},request:function(b,a){if(window.XMLHttpRequest){this.req=new XMLHttpRequest();this.req.onreadystatechange=a;this.req.open("GET",b,true);this.req.send(null)}else{if(window.ActiveXObject){this.req=new ActiveXObject("Microsoft.XMLHTTP");if(this.req){this.req.onreadystatechange=a;this.req.open("GET",b,true);this.req.send()}}}},loadImage:function(b){var a=new Image();a.src=b;a.className="rcImage";this.images[b]=a;return a}};