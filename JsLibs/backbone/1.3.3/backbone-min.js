(function(f){var a=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global;if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(e,h,g){a.Backbone=f(a,g,e,h)})}else{if(typeof exports!=="undefined"){var b=require("underscore"),d;try{d=require("jquery")}catch(c){}f(a,exports,b,d)}else{a.Backbone=f(a,{},a._,a.jQuery||a.Zepto||a.ender||a.$)}}})(function(ax,X,ae,at){var al=ax.Backbone;var av=Array.prototype.slice;X.VERSION="1.3.3";X.$=at;X.noConflict=function(){ax.Backbone=al;return this};X.emulateHTTP=false;X.emulateJSON=false;var G=function(c,a,b){switch(c){case 1:return function(){return ae[a](this[b])};case 2:return function(d){return ae[a](this[b],d)};case 3:return function(e,d){return ae[a](this[b],an(e,this),d)};case 4:return function(f,d,e){return ae[a](this[b],an(f,this),d,e)};default:return function(){var d=av.call(arguments);d.unshift(this[b]);return ae[a].apply(ae,d)}}};var ac=function(c,a,b){ae.each(a,function(d,f){if(ae[f]){c.prototype[f]=G(d,f,b)}})};var an=function(b,a){if(ae.isFunction(b)){return b}if(ae.isObject(b)&&!a._isModel(b)){return ai(b)}if(ae.isString(b)){return function(c){return c.get(b)}}return b};var ai=function(b){var a=ae.matches(b);return function(c){return a(c.attributes)}};var az=X.Events={};var Q=/\s+/;var Z=function(j,c,g,f,i){var b=0,d;if(g&&typeof g==="object"){if(f!==void 0&&"context" in i&&i.context===void 0){i.context=f}for(d=ae.keys(g);b<d.length;b++){c=Z(j,c,d[b],g[d[b]],i)}}else{if(g&&Q.test(g)){for(d=g.split(Q);b<d.length;b++){c=j(c,d[b],f,i)}}else{c=j(c,g,f,i)}}return c};az.on=function(c,a,b){return W(this,c,a,b)};var W=function(g,a,b,d,c){g._events=Z(aB,g._events||{},a,b,{context:d,ctx:g,listening:c});if(c){var f=g._listeners||(g._listeners={});f[c.id]=c}return g};az.listenTo=function(j,c,g){if(!j){return this}var f=j._listenId||(j._listenId=ae.uniqueId("l"));var i=this._listeningTo||(this._listeningTo={});var b=i[f];if(!b){var d=this._listenId||(this._listenId=ae.uniqueId("l"));b=i[f]={obj:j,objId:f,id:d,listeningTo:i,count:0}}W(j,c,g,this,b);return this};var aB=function(l,c,f,j){if(f){var g=l[c]||(l[c]=[]);var k=j.context,b=j.ctx,d=j.listening;if(d){d.count++}g.push({callback:f,context:k,ctx:k||b,listening:d})}return l};az.off=function(c,a,b){if(!this._events){return this}this._events=Z(ab,this._events,c,a,{context:b,listeners:this._listeners});return this};az.stopListening=function(j,c,g){var f=this._listeningTo;if(!f){return this}var i=j?[j._listenId]:ae.keys(f);for(var b=0;b<i.length;b++){var d=f[i[b]];if(!d){break}d.obj.off(c,g,this)}return this};var ab=function(A,j,x,q){if(!A){return}var y=0,b;var m=q.context,w=q.listeners;if(!j&&!x&&!m){var p=ae.keys(w);for(;y<p.length;y++){b=w[p[y]];delete w[b.id];delete b.listeningTo[b.objId]}return}var B=j?[j]:ae.keys(A);for(;y<B.length;y++){j=B[y];var g=A[j];if(!g){break}var k=[];for(var i=0;i<g.length;i++){var C=g[i];if(x&&x!==C.callback&&x!==C.callback._callback||m&&m!==C.context){k.push(C)}else{b=C.listening;if(b&&--b.count===0){delete w[b.id];delete b.listeningTo[b.objId]}}}if(k.length){A[j]=k}else{delete A[j]}}return A};az.once=function(d,a,c){var b=Z(ap,{},d,a,ae.bind(this.off,this));if(typeof d==="string"&&c==null){a=void 0}return this.on(b,a,c)};az.listenToOnce=function(d,a,c){var b=Z(ap,{},a,c,ae.bind(this.stopListening,this,d));return this.listenTo(d,b)};var ap=function(f,a,c,b){if(c){var d=f[a]=ae.once(function(){b(a,d);c.apply(this,arguments)});d._callback=c}return f};az.trigger=function(d){if(!this._events){return this}var a=Math.max(0,arguments.length-1);var b=Array(a);for(var c=0;c<a;c++){b[c]=arguments[c+1]}Z(aj,this._events,d,void 0,b);return this};var aj=function(g,a,b,d){if(g){var c=g[a];var f=g.all;if(c&&f){f=f.slice()}if(c){D(c,d)}if(f){D(f,[a].concat(d))}}return g};var D=function(l,c){var f,j=-1,g=l.length,k=c[0],b=c[1],d=c[2];switch(c.length){case 0:while(++j<g){(f=l[j]).callback.call(f.ctx)}return;case 1:while(++j<g){(f=l[j]).callback.call(f.ctx,k)}return;case 2:while(++j<g){(f=l[j]).callback.call(f.ctx,k,b)}return;case 3:while(++j<g){(f=l[j]).callback.call(f.ctx,k,b,d)}return;default:while(++j<g){(f=l[j]).callback.apply(f.ctx,c)}return}};az.bind=az.on;az.unbind=az.off;ae.extend(X,az);var aE=X.Model=function(d,a){var c=d||{};a||(a={});this.cid=ae.uniqueId(this.cidPrefix);this.attributes={};if(a.collection){this.collection=a.collection}if(a.parse){c=this.parse(c,a)||{}}var b=ae.result(this,"defaults");c=ae.defaults(ae.extend({},b,c),b);this.set(c,a);this.changed={};this.initialize.apply(this,arguments)};ae.extend(aE.prototype,az,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(a){return ae.clone(this.attributes)},sync:function(){return X.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return ae.escape(this.get(a))},has:function(a){return this.get(a)!=null},matches:function(a){return !!ae.iteratee(a,this)(this.attributes)},set:function(y,j,w){if(y==null){return this}var q;if(typeof y==="object"){q=y;w=j}else{(q={})[y]=j}w||(w={});if(!this._validate(q,w)){return false}var x=w.unset;var b=w.silent;var m=[];var v=this._changing;this._changing=true;if(!v){this._previousAttributes=ae.clone(this.attributes);this.changed={}}var p=this.attributes;var A=this.changed;var g=this._previousAttributes;for(var k in q){j=q[k];if(!ae.isEqual(p[k],j)){m.push(k)}if(!ae.isEqual(g[k],j)){A[k]=j}else{delete A[k]}x?delete p[k]:p[k]=j}if(this.idAttribute in q){this.id=this.get(this.idAttribute)}if(!b){if(m.length){this._pending=w}for(var i=0;i<m.length;i++){this.trigger("change:"+m[i],this,p[m[i]],w)}}if(v){return this}if(!b){while(this._pending){w=this._pending;this._pending=false;this.trigger("change",this,w)}}this._pending=false;this._changing=false;return this},unset:function(b,a){return this.set(b,void 0,ae.extend({},a,{unset:true}))},clear:function(c){var a={};for(var b in this.attributes){a[b]=void 0}return this.set(a,ae.extend({},c,{unset:true}))},hasChanged:function(a){if(a==null){return !ae.isEmpty(this.changed)}return ae.has(this.changed,a)},changedAttributes:function(f){if(!f){return this.hasChanged()?ae.clone(this.changed):false}var a=this._changing?this._previousAttributes:this.attributes;var c={};for(var b in f){var d=f[b];if(ae.isEqual(a[b],d)){continue}c[b]=d}return ae.size(c)?c:false},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return ae.clone(this._previousAttributes)},fetch:function(c){c=ae.extend({parse:true},c);var a=this;var b=c.success;c.success=function(d){var e=c.parse?a.parse(d,c):d;if(!a.set(e,c)){return false}if(b){b.call(c.context,a,d,c)}a.trigger("sync",a,d,c)};L(this,c);return this.sync("read",this,c)},save:function(m,c,j){var g;if(m==null||typeof m==="object"){g=m;j=c}else{(g={})[m]=c}j=ae.extend({validate:true,parse:true},j);var k=j.wait;if(g&&!k){if(!this.set(g,j)){return false}}else{if(!this._validate(g,j)){return false}}var b=this;var d=j.success;var i=this.attributes;j.success=function(h){b.attributes=i;var a=j.parse?b.parse(h,j):h;if(k){a=ae.extend({},g,a)}if(a&&!b.set(a,j)){return false}if(d){d.call(j.context,b,h,j)}b.trigger("sync",b,h,j)};L(this,j);if(g&&k){this.attributes=ae.extend({},i,g)}var f=this.isNew()?"create":j.patch?"patch":"update";if(f==="patch"&&!j.attrs){j.attrs=g}var p=this.sync(f,this,j);this.attributes=i;return p},destroy:function(h){h=h?ae.clone(h):{};var c=this;var f=h.success;var d=h.wait;var g=function(){c.stopListening();c.trigger("destroy",c,c.collection,h)};h.success=function(a){if(d){g()}if(f){f.call(h.context,c,a,h)}if(!c.isNew()){c.trigger("sync",c,a,h)}};var b=false;if(this.isNew()){ae.defer(h.success)}else{L(this,h);b=this.sync("delete",this,h)}if(!d){g()}return b},url:function(){var b=ae.result(this,"urlRoot")||ae.result(this.collection,"url")||aa();if(this.isNew()){return b}var a=this.get(this.idAttribute);return b.replace(/[^\/]$/,"$&/")+encodeURIComponent(a)},parse:function(b,a){return b},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},ae.extend({},a,{validate:true}))},_validate:function(c,a){if(!a.validate||!this.validate){return true}c=ae.extend({},this.attributes,c);var b=this.validationError=this.validate(c,a)||null;if(!b){return true}this.trigger("invalid",this,b,ae.extend(a,{validationError:b}));return false}});var K={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};ac(aE,K,"attributes");var aD=X.Collection=function(b,a){a||(a={});if(a.model){this.model=a.model}if(a.comparator!==void 0){this.comparator=a.comparator}this._reset();this.initialize.apply(this,arguments);if(b){this.reset(b,ae.extend({silent:true},a))}};var aC={add:true,remove:true,merge:true};var Y={add:true,remove:false};var af=function(g,a,b){b=Math.min(Math.max(b,0),g.length);var d=Array(g.length-b);var c=a.length;var f;for(f=0;f<d.length;f++){d[f]=g[f+b]}for(f=0;f<c;f++){g[f+b]=a[f]}for(f=0;f<d.length;f++){g[f+c+b]=d[f]}};ae.extend(aD.prototype,az,{model:aE,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return X.sync.apply(this,arguments)},add:function(b,a){return this.set(b,ae.extend({merge:false},a,Y))},remove:function(d,a){a=ae.extend({},a);var c=!ae.isArray(d);d=c?[d]:d.slice();var b=this._removeModels(d,a);if(!a.silent&&b.length){a.changes={added:[],merged:[],removed:b};this.trigger("update",this,a)}return c?b[0]:b},set:function(R,A){if(R==null){return}A=ae.extend({},aC,A);if(A.parse&&!this._isModel(R)){R=this.parse(R,A)||[]}var O=!ae.isArray(R);R=O?[R]:R.slice();var I=A.at;if(I!=null){I=+I}if(I>this.length){I=this.length}if(I<0){I+=this.length+1}var P=[];var j=[];var E=[];var M=[];var F={};var S=A.add;var q=A.merge;var B=A.remove;var w=false;var T=this.comparator&&I==null&&A.sort!==false;var C=ae.isString(this.comparator)?this.comparator:null;var N,H;for(H=0;H<R.length;H++){N=R[H];var i=this.get(N);if(i){if(q&&N!==i){var aF=this._isModel(N)?N.attributes:N;if(A.parse){aF=i.parse(aF,A)}i.set(aF,A);E.push(i);if(T&&!w){w=i.hasChanged(C)}}if(!F[i.cid]){F[i.cid]=true;P.push(i)}R[H]=i}else{if(S){N=R[H]=this._prepareModel(N,A);if(N){j.push(N);this._addReference(N,A);F[N.cid]=true;P.push(N)}}}}if(B){for(H=0;H<this.length;H++){N=this.models[H];if(!F[N.cid]){M.push(N)}}if(M.length){this._removeModels(M,A)}}var k=false;var U=!T&&S&&B;if(P.length&&U){k=this.length!==P.length||ae.some(this.models,function(b,a){return b!==P[a]});this.models.length=0;af(this.models,P,0);this.length=this.models.length}else{if(j.length){if(T){w=true}af(this.models,j,I==null?this.length:I);this.length=this.models.length}}if(w){this.sort({silent:true})}if(!A.silent){for(H=0;H<j.length;H++){if(I!=null){A.index=I+H}N=j[H];N.trigger("add",N,this,A)}if(w||k){this.trigger("sort",this,A)}if(j.length||M.length||E.length){A.changes={added:j,removed:M,merged:E};this.trigger("update",this,A)}}return O?R[0]:R},reset:function(c,a){a=a?ae.clone(a):{};for(var b=0;b<this.models.length;b++){this._removeReference(this.models[b],a)}a.previousModels=this.models;this._reset();c=this.add(c,ae.extend({silent:true},a));if(!a.silent){this.trigger("reset",this,a)}return c},push:function(b,a){return this.add(b,ae.extend({at:this.length},a))},pop:function(b){var a=this.at(this.length-1);return this.remove(a,b)},unshift:function(b,a){return this.add(b,ae.extend({at:0},a))},shift:function(b){var a=this.at(0);return this.remove(a,b)},slice:function(){return av.apply(this.models,arguments)},get:function(a){if(a==null){return void 0}return this._byId[a]||this._byId[this.modelId(a.attributes||a)]||a.cid&&this._byId[a.cid]},has:function(a){return this.get(a)!=null},at:function(a){if(a<0){a+=this.length}return this.models[a]},where:function(b,a){return this[a?"find":"filter"](b)},findWhere:function(a){return this.where(a,true)},sort:function(c){var a=this.comparator;if(!a){throw new Error("Cannot sort a set without a comparator")}c||(c={});var b=a.length;if(ae.isFunction(a)){a=ae.bind(a,this)}if(b===1||ae.isString(a)){this.models=this.sortBy(a)}else{this.models.sort(a)}if(!c.silent){this.trigger("sort",this,c)}return this},pluck:function(a){return this.map(a+"")},fetch:function(c){c=ae.extend({parse:true},c);var a=c.success;var b=this;c.success=function(d){var e=c.reset?"reset":"set";b[e](d,c);if(a){a.call(c.context,b,d,c)}b.trigger("sync",b,d,c)};L(this,c);return this.sync("read",this,c)},create:function(f,a){a=a?ae.clone(a):{};var c=a.wait;f=this._prepareModel(f,a);if(!f){return false}if(!c){this.add(f,a)}var b=this;var d=a.success;a.success=function(j,g,h){if(c){b.add(j,h)}if(d){d.call(h.context,j,g,h)}};f.save(null,a);return f},parse:function(b,a){return b},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(c,a){if(this._isModel(c)){if(!c.collection){c.collection=this}return c}a=a?ae.clone(a):{};a.collection=this;var b=new this.model(c,a);if(!b.validationError){return b}this.trigger("invalid",this,b.validationError,a);return false},_removeModels:function(j,c){var d=[];for(var g=0;g<j.length;g++){var f=this.get(j[g]);if(!f){continue}var h=this.indexOf(f);this.models.splice(h,1);this.length--;delete this._byId[f.cid];var b=this.modelId(f.attributes);if(b!=null){delete this._byId[b]}if(!c.silent){c.index=h;f.trigger("remove",f,this,c)}d.push(f);this._removeReference(f,c)}return d},_isModel:function(a){return a instanceof aE},_addReference:function(c,a){this._byId[c.cid]=c;var b=this.modelId(c.attributes);if(b!=null){this._byId[b]=c}c.on("all",this._onModelEvent,this)},_removeReference:function(c,a){delete this._byId[c.cid];var b=this.modelId(c.attributes);if(b!=null){delete this._byId[b]}if(this===c.collection){delete c.collection}c.off("all",this._onModelEvent,this)},_onModelEvent:function(g,a,b,d){if(a){if((g==="add"||g==="remove")&&b!==this){return}if(g==="destroy"){this.remove(a,d)}if(g==="change"){var c=this.modelId(a.previousAttributes());var f=this.modelId(a.attributes);if(c!==f){if(c!=null){delete this._byId[c]}if(f!=null){this._byId[f]=a}}}}this.trigger.apply(this,arguments)}});var aw={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};ac(aD,aw,"models");var ah=X.View=function(a){this.cid=ae.uniqueId("view");ae.extend(this,ae.pick(a,aq));this._ensureElement();this.initialize.apply(this,arguments)};var ay=/^(\S+)\s*(.*)$/;var aq=["model","collection","el","id","attributes","className","tagName","events"];ae.extend(ah.prototype,az,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(a){this.undelegateEvents();this._setElement(a);this.delegateEvents();return this},_setElement:function(a){this.$el=a instanceof X.$?a:X.$(a);this.el=this.$el[0]},delegateEvents:function(d){d||(d=ae.result(this,"events"));if(!d){return this}this.undelegateEvents();for(var a in d){var c=d[a];if(!ae.isFunction(c)){c=this[c]}if(!c){continue}var b=a.match(ay);this.delegate(b[1],b[2],ae.bind(c,this))}return this},delegate:function(c,a,b){this.$el.on(c+".delegateEvents"+this.cid,a,b);return this},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(c,a,b){this.$el.off(c+".delegateEvents"+this.cid,a,b);return this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(!this.el){var a=ae.extend({},ae.result(this,"attributes"));if(this.id){a.id=ae.result(this,"id")}if(this.className){a["class"]=ae.result(this,"className")}this.setElement(this._createElement(ae.result(this,"tagName")));this._setAttributes(a)}else{this.setElement(ae.result(this,"el"))}},_setAttributes:function(a){this.$el.attr(a)}});X.sync=function(j,g,e){var i=ad[j];ae.defaults(e||(e={}),{emulateHTTP:X.emulateHTTP,emulateJSON:X.emulateJSON});var b={type:i,dataType:"json"};if(!e.url){b.url=ae.result(g,"url")||aa()}if(e.data==null&&g&&(j==="create"||j==="update"||j==="patch")){b.contentType="application/json";b.data=JSON.stringify(e.attrs||g.toJSON(e))}if(e.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(e.emulateHTTP&&(i==="PUT"||i==="DELETE"||i==="PATCH")){b.type="POST";if(e.emulateJSON){b.data._method=i}var c=e.beforeSend;e.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",i);if(c){return c.apply(this,arguments)}}}if(b.type!=="GET"&&!e.emulateJSON){b.processData=false}var f=e.error;e.error=function(k,a,h){e.textStatus=a;e.errorThrown=h;if(f){f.call(e.context,k,a,h)}};var d=e.xhr=X.ajax(ae.extend(b,e));g.trigger("request",g,d,e);return d};var ad={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};X.ajax=function(){return X.$.ajax.apply(X.$,arguments)};var z=X.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var J=/\((.*?)\)/g;var V=/(\(\?)?:\w+/g;var au=/\*\w+/g;var ag=/[\-{}\[\]+?.,\\\^$|#\s]/g;ae.extend(z.prototype,az,{initialize:function(){},route:function(d,b,a){if(!ae.isRegExp(d)){d=this._routeToRegExp(d)}if(ae.isFunction(b)){a=b;b=""}if(!a){a=this[b]}var c=this;X.history.route(d,function(f){var e=c._extractParameters(d,f);if(c.execute(a,e,b)!==false){c.trigger.apply(c,["route:"+b].concat(e));c.trigger("route",b,e);X.history.trigger("route",c,b,e)}});return this},execute:function(c,a,b){if(c){c.apply(this,a)}},navigate:function(b,a){X.history.navigate(b,a);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=ae.result(this,"routes");var b,a=ae.keys(this.routes);while((b=a.pop())!=null){this.route(b,this.routes[b])}},_routeToRegExp:function(a){a=a.replace(ag,"\\$&").replace(J,"(?:$1)?").replace(V,function(c,b){return b?c:"([^/?]+)"}).replace(au,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(c,a){var b=c.exec(a).slice(1);return ae.map(b,function(f,d){if(d===b.length-1){return f||null}return f?decodeURIComponent(f):null})}});var am=X.History=function(){this.handlers=[];this.checkUrl=ae.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var ak=/^[#\/]|\s+$/g;var ao=/^\/+|\/+$/g;var aA=/#.*$/;am.started=false;ae.extend(am.prototype,az,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var b=this.decodeFragment(this.location.pathname);var a=b.slice(0,this.root.length-1)+"/";return a===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(b){var a=(b||this).location.href.match(/#(.*)$/);return a?a[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return a.charAt(0)==="/"?a.slice(1):a},getFragment:function(a){if(a==null){if(this._usePushState||!this._wantsHashChange){a=this.getPath()}else{a=this.getHash()}}return a.replace(ak,"")},start:function(f){if(am.started){throw new Error("Backbone.history has already been started")}am.started=true;this.options=ae.extend({root:"/"},this.options,f);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._hasHashChange="onhashchange" in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(ao,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var a=this.root.slice(0,-1)||"/";this.location.replace(a+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var c=document.body;var b=c.insertBefore(this.iframe,c.firstChild).contentWindow;b.document.open();b.document.close();b.location.hash="#"+this.fragment}var d=window.addEventListener||function(h,g){return attachEvent("on"+h,g)};if(this._usePushState){d("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){d("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var a=window.removeEventListener||function(c,b){return detachEvent("on"+c,b)};if(this._usePushState){a("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){a("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}am.started=false},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(b){var a=this.getFragment();if(a===this.fragment&&this.iframe){a=this.getHash(this.iframe.contentWindow)}if(a===this.fragment){return false}if(this.iframe){this.navigate(a)}this.loadUrl()},loadUrl:function(a){if(!this.matchRoot()){return false}a=this.fragment=this.getFragment(a);return ae.some(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(f,a){if(!am.started){return false}if(!a||a===true){a={trigger:!!a}}f=this.getFragment(f||"");var b=this.root;if(f===""||f.charAt(0)==="?"){b=b.slice(0,-1)||"/"}var d=b+f;f=this.decodeFragment(f.replace(aA,""));if(this.fragment===f){return}this.fragment=f;if(this._usePushState){this.history[a.replace?"replaceState":"pushState"]({},document.title,d)}else{if(this._wantsHashChange){this._updateHash(this.location,f,a.replace);if(this.iframe&&f!==this.getHash(this.iframe.contentWindow)){var c=this.iframe.contentWindow;if(!a.replace){c.document.open();c.document.close()}this._updateHash(c.location,f,a.replace)}}else{return this.location.assign(d)}}if(a.trigger){return this.loadUrl(f)}},_updateHash:function(d,a,b){if(b){var c=d.href.replace(/(javascript:|#).*$/,"");d.replace(c+"#"+a)}else{d.hash="#"+a}}});X.history=new am;var ar=function(d,a){var c=this;var b;if(d&&ae.has(d,"constructor")){b=d.constructor}else{b=function(){return c.apply(this,arguments)}}ae.extend(b,c,a);b.prototype=ae.create(c.prototype,d);b.prototype.constructor=b;b.__super__=c.prototype;return b};aE.extend=aD.extend=z.extend=ah.extend=am.extend=ar;var aa=function(){throw new Error('A "url" property or function must be specified')};var L=function(c,a){var b=a.error;a.error=function(d){if(b){b.call(a.context,c,d,a)}c.trigger("error",c,d,a)}};return X});