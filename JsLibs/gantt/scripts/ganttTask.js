function TaskFactory(){this.build=function(e,g,c,f,h,d){var a=computeStart(h);var b=computeEndByDuration(a,d);return new Task(e,g,c,f,a,b,d)}}function Task(d,f,a,e,g,c,b){this.id=d;this.name=f;this.progress=0;this.description="";this.code=a;this.level=e;this.status="STATUS_UNDEFINED";this.depends="";this.canWrite=true;this.start=g;this.duration=b;this.end=c;this.startIsMilestone=false;this.endIsMilestone=false;this.collapsed=false;this.rowElement;this.ganttElement;this.master;this.assigs=[]}Task.prototype.clone=function(){var b={};for(var a in this){if(typeof(this[a])!="function"){b[a]=this[a]}}return b};Task.prototype.getAssigsString=function(){var d="";for(var b=0;b<this.assigs.length;b++){var a=this.assigs[b];var c=this.master.getResource(a.resourceId);if(c){d=d+(d==""?"":", ")+c.name}}return d};Task.prototype.createAssignment=function(c,d,e,b){var a=new Assignment(c,d,e,b);this.assigs.push(a);return a};Task.prototype.setPeriod=function(p,f){if(p instanceof Date){p=p.getTime()}if(f instanceof Date){f=f.getTime()}var k={start:this.start,end:this.end,duration:this.duration};var u=p;if(p>f){p=f}p=computeStart(p);var r=this.getSuperiors();if(r&&r.length>0){var q=0;for(var g=0;g<r.length;g++){var j=r[g];q=Math.max(q,incrementDateByWorkingDays(j.from.end,j.lag))}if(computeStart(q)!=p){return this.moveTo(q+1,false)}}var o=false;var d=new Date(p);if(this.start!=p||this.start!=u){this.start=p;o=true}var t=f;f=computeEnd(f);if(this.end!=f||this.end!=t){this.end=f;o=true}this.duration=recomputeDuration(this.start,this.end);if(!o){return true}if(!this.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+this.name,this);return false}if(this.hasExternalDep){this.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS+"\n"+this.name,this);return false}var s=true;var e=k.duration-this.duration;var l=e>0;var n=l&&(k.start<this.start);var m=l&&(k.end>this.end);if(l){var c=this.getChildren();var b=Infinity;var a=0;for(var g=0;g<c.length;g++){ch=c[g];if(m){a=Math.max(a,ch.end)}else{b=Math.min(b,ch.start)}}if(m){this.end=Math.max(a,this.end)}else{this.start=Math.min(b,this.start)}this.duration=recomputeDuration(this.start,this.end)}else{if(this.start<this.master.minEditableDate||this.end>this.master.maxEditableDate){this.master.setErrorOnTransaction(GanttMaster.messages.CHANGE_OUT_OF_SCOPE,this);s=false}if(s&&!updateTree(this)){s=false}}if(s){var h=this.getInferiors();if(h&&h.length>0){for(var g=0;g<h.length;g++){var j=h[g];if(!j.to.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+j.to.name,j.to);break}s=j.to.moveTo(f,false);if(!s){break}}}}return s};Task.prototype.moveTo=function(j,d){if(j instanceof Date){j=j.getTime()}var g={start:this.start,end:this.end};var m=j;j=computeStart(j);if(!d&&this.startIsMilestone&&j!=this.start){this.master.setErrorOnTransaction(GanttMaster.messages.START_IS_MILESTONE,this);return false}else{if(this.hasExternalDep){this.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS,this);return false}}var l=this.getSuperiors();if(l&&l.length>0){var k=0;for(var c=0;c<l.length;c++){var f=l[c];k=Math.max(k,incrementDateByWorkingDays(f.from.end,f.lag))}j=k+1}j=computeStart(j);var b=computeEndByDuration(j,this.duration);if(this.start!=j||this.start!=m){if(!d&&this.endIsMilestone){b=this.end;this.duration=recomputeDuration(j,b)}this.start=j;this.end=b;if(this.start<this.master.minEditableDate||this.end>this.master.maxEditableDate){this.master.setErrorOnTransaction(GanttMaster.messages.CHANGE_OUT_OF_SCOPE,this);return false}var h=g.start-this.start;var a=this.getChildren();for(var c=0;c<a.length;c++){ch=a[c];if(!ch.moveTo(ch.start-h,false)){return false}}if(!updateTree(this)){return false}var e=this.getInferiors();if(e&&e.length>0){for(var c=0;c<e.length;c++){var f=e[c];if(!f.to.canWrite){this.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+f.to.name,f.to)}else{if(!f.to.moveTo(b,false)){return false}}}}}return true};function updateTree(e){var a;var d=e.getParent();if(!d){return true}var c=d.start;var b=d.end;if(d.start>e.start){if(d.startIsMilestone){e.master.setErrorOnTransaction(GanttMaster.messages.START_IS_MILESTONE+"\n"+d.name,e);return false}else{if(d.depends){e.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_CONSTRAINTS+"\n"+d.name,e);return false}}c=e.start}if(d.end<e.end){if(d.endIsMilestone){e.master.setErrorOnTransaction(GanttMaster.messages.END_IS_MILESTONE+"\n"+d.name,e);return false}b=e.end}if(c!=d.start||b!=d.end){if(!d.canWrite){e.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_WRITE+"\n"+d.name,e);return false}if(d.hasExternalDep){e.master.setErrorOnTransaction(GanttMaster.messages.TASK_HAS_EXTERNAL_DEPS+"\n"+d.name,e);return false}return d.setPeriod(c,b)}return true}Task.prototype.changeStatus=function(b){var a=this.getDescendant();function d(r,l,k,p,o){var m=r.status;if(l==m){return true}var s=true;r.status=l;if(r.master.cannotCloseTaskIfIssueOpen&&l=="STATUS_DONE"&&r.openIssues>0){r.master.setErrorOnTransaction(GanttMaster.messages.CANNOT_CLOSE_TASK_IF_OPEN_ISSUE+" "+r.name);return false}if(l=="STATUS_DONE"){if((k||m!="STATUS_FAILED")){var q=r.getSuperiors();for(var h=0;h<q.length;h++){if(a.indexOf(q[h].from)<0){if(q[h].from.status!="STATUS_DONE"){if(k||p){r.master.setErrorOnTransaction(GanttMaster.messages.GANTT_ERROR_DEPENDS_ON_OPEN_TASK+"\n"+q[h].from.name+" -> "+r.name)}s=false;break}}}if(s){var g=r.getChildren();for(var h=0;h<g.length;h++){d(g[h],"STATUS_DONE",false,true,false)}e(a,r.getInferiors(),"STATUS_ACTIVE")}}else{s=false}}else{if(l=="STATUS_ACTIVE"){if((k||m!="STATUS_FAILED")){var n=r.getParent();if(n&&n.status!="STATUS_ACTIVE"){s=d(n,"STATUS_ACTIVE",false,false,true)}if(s){var q=r.getSuperiors();for(var h=0;h<q.length;h++){if(q[h].from.status!="STATUS_DONE"){if(k||o){r.master.setErrorOnTransaction(GanttMaster.messages.GANTT_ERROR_DEPENDS_ON_OPEN_TASK+"\n"+q[h].from.name+" -> "+r.name)}s=false;break}}}if(s){var g=r.getChildren();if(m=="STATUS_UNDEFINED"||m=="STATUS_SUSPENDED"){for(var h=0;h<g.length;h++){if(g[h].status!="STATUS_DONE"){d(g[h],"STATUS_ACTIVE",false,true,false)}}}var j=r.getInferiors();for(var h=0;h<j.length;h++){d(j[h].to,"STATUS_SUSPENDED",false,false,false)}}}else{s=false}}else{if(l=="STATUS_SUSPENDED"||l=="STATUS_UNDEFINED"){if(k||m!="STATUS_FAILED"){var n=r.getParent();if(n&&n.status!="STATUS_ACTIVE"){s=d(n,l,false,false,true)}var g=r.getChildren();for(var h=0;h<g.length;h++){if(g[h].status!="STATUS_DONE"){d(g[h],l,false,true,false)}}e(a,r.getInferiors(),l)}else{s=false}}else{if(l=="STATUS_FAILED"){var g=r.getChildren();for(var h=0;h<g.length;h++){d(g[h],"STATUS_FAILED",false,true,false)}e(a,r.getInferiors(),"STATUS_FAILED")}}}}if(!s){r.status=m}return s}function e(g,j,k){for(var h=0;h<j.length;h++){if(g.indexOf(j[h].to)<0){d(j[h].to,k,false,false,false)}}}var f=true;var c=this.status;f=d(this,b,true,false,false);if(!f){this.status=c}return f};Task.prototype.synchronizeStatus=function(){var a=this.status;this.status="";return this.changeStatus(a)};Task.prototype.isLocallyBlockedByDependencies=function(){var c=this.getSuperiors();var a=false;for(var b=0;b<c.length;b++){if(c[b].from.status!="STATUS_DONE"){a=true;break}}return a};Task.prototype.getRow=function(){ret=-1;if(this.master){ret=this.master.tasks.indexOf(this)}return ret};Task.prototype.getParents=function(){var d;if(this.master){var e=this.level;var c=this.getRow();d=[];for(var a=c;a>=0;a--){var b=this.master.tasks[a];if(e>b.level){e=b.level;d.push(b)}}}return d};Task.prototype.getParent=function(){var c;if(this.master){for(var a=this.getRow();a>=0;a--){var b=this.master.tasks[a];if(this.level>b.level){c=b;break}}}return c};Task.prototype.isParent=function(){var b=false;if(this.master){var a=this.getRow();if(a<this.master.tasks.length-1){b=this.master.tasks[a+1].level>this.level}}return b};Task.prototype.getChildren=function(){var d=[];if(this.master){var c=this.getRow();for(var b=c+1;b<this.master.tasks.length;b++){var a=this.master.tasks[b];if(a.level==this.level+1){d.push(a)}else{if(a.level<=this.level){break}}}}return d};Task.prototype.getDescendant=function(){var d=[];if(this.master){var c=this.getRow();for(var b=c+1;b<this.master.tasks.length;b++){var a=this.master.tasks[b];if(a.level>this.level){d.push(a)}else{break}}}return d};Task.prototype.getSuperiors=function(){var a=[];var b=this;if(this.master){a=this.master.links.filter(function(c){return c.to==b})}return a};Task.prototype.getSuperiorTasks=function(){var b=[];var c=this.getSuperiors();for(var a=0;a<c.length;a++){b.push(c[a].from)}return b};Task.prototype.getInferiors=function(){var a=[];var b=this;if(this.master){a=this.master.links.filter(function(c){return c.from==b})}return a};Task.prototype.getInferiorTasks=function(){var c=[];var b=this.getInferiors();for(var a=0;a<b.length;a++){c.push(b[a].to)}return c};Task.prototype.deleteTask=function(){this.rowElement.remove();this.ganttElement.remove();var a=this.getChildren();for(var b=0;b<a.length;b++){if(!a[b].isNew()){this.master.deletedTaskIds.push(a[b].id)}a[b].deleteTask()}if(!this.isNew()){this.master.deletedTaskIds.push(this.id)}this.master.tasks.splice(this.getRow(),1);var c=this;this.master.links=this.master.links.filter(function(d){return d.from!=c&&d.to!=c})};Task.prototype.isNew=function(){return(this.id+"").indexOf("tmp_")==0};Task.prototype.isDependent=function(c){var d=this;var a=this.master.links.filter(function(e){return e.from==d});for(var b=0;b<a.length;b++){if(a[b].to==c){return true}}for(var b=0;b<a.length;b++){if(a[b].to.isDependent(c)){return true}}return false};Task.prototype.setLatest=function(a){this.latestStart=a-this.criticalCost;this.latestFinish=this.latestStart+this.duration};Task.prototype.indent=function(){var j=this.getRow();if(j<=0){return false}var h=false;var k=this.master.tasks[j-1];var e=this.level+1;if(e<=k.level+1){h=true;this.level++;var b=this.getParents();this.level--;var f=this.level;for(var c=j;c<this.master.tasks.length;c++){var a=this.master.tasks[c];if(a.level>f||a==this){a.level++;this.master.links=this.master.links.filter(function(i){var l=false;if(i.to==a){l=b.indexOf(i.from)>=0}else{if(i.from==a){l=b.indexOf(i.to)>=0}}return !l})}else{break}}var g=this.getParent();if(g&&!this.depends){var d=computeEndByDuration(g.start,this.duration);this.master.changeTaskDates(this,g.start,d)}this.master.updateDependsStrings();this.setPeriod(this.start+1,this.end+1);this.synchronizeStatus()}return h};Task.prototype.outdent=function(){if(this.level<=1){return false}var e=false;var d=this.level;e=true;var f=this.getRow();for(var c=f;c<this.master.tasks.length;c++){var b=this.master.tasks[c];if(b.level>d||b==this){b.level--}else{break}}var g=this;var a=this.getChildren();this.master.links=this.master.links.filter(function(h){var i=(h.to==g&&a.indexOf(h.from)>=0||h.from==g&&a.indexOf(h.to)>=0);return !i});for(var c=0;c<a.length;c++){a[c].setPeriod(a[c].start+1,a[c].end+1)}this.master.updateDependsStrings();this.setPeriod(this.start+1,this.end+1);this.synchronizeStatus();return e};Task.prototype.moveUp=function(){var g=false;var h=this.getRow();if(h<=0){return false}var f;for(f=h-1;f>=0;f--){if(this.master.tasks[f].level<=this.level){break}}if(this.master.tasks[f].level==this.level){g=true;var c=0;for(var e=h+1;e<this.master.tasks.length;e++){var b=this.master.tasks[e];if(b.level>this.level){c++}else{break}}var a=this.master.tasks.splice(h,c+1);var k=this.master.tasks.splice(0,f);this.master.tasks=[].concat(k,a,this.master.tasks);var j=this.master.editor.element.find("tr[taskId]");var d=j.slice(h,h+c+1);j.eq(f).before(d);this.master.updateDependsStrings()}else{this.master.setErrorOnTransaction(GanttMaster.messages.TASK_MOVE_INCONSISTENT_LEVEL,this);g=false}return g};Task.prototype.moveDown=function(){var j=this.getRow();if(j>=this.master.tasks.length-1||j==0){return false}var h=false;var g;for(g=j+1;g<this.master.tasks.length;g++){if(this.master.tasks[g].level<=this.level){break}}if(this.master.tasks[g]&&this.master.tasks[g].level==this.level){h=true;for(g=g+1;g<this.master.tasks.length;g++){if(this.master.tasks[g].level<=this.level){break}}var d=0;for(var f=j+1;f<this.master.tasks.length;f++){var c=this.master.tasks[f];if(c.level>this.level){d++}else{break}}var b=this.master.tasks.splice(j,d+1);var l=this.master.tasks.splice(0,g-d-1);this.master.tasks=[].concat(l,b,this.master.tasks);var k=this.master.editor.element.find("tr[taskId]");var a=k.eq(g-1);var e=k.slice(j,j+d+1);a.after(e);this.master.updateDependsStrings()}return h};function Link(b,c,a){this.from=b;this.to=c;this.lag=a}function Assignment(b,c,d,a){this.id=b;this.resourceId=c;this.roleId=d;this.effort=a}function Resource(a,b){this.id=a;this.name=b}function Role(a,b){this.id=a;this.name=b};