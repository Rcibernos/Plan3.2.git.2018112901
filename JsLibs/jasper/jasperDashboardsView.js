var JRSClient;var JRSPreview;var utils={};var visualizeDashboard={create:function create(a){utils={jrsUrl:"http://demoreports.cibernos.com:8080/jasperserver-pro",jrsUsername:a.jrsUserName,jrsPassword:a.jrsPassword,jrsOrganization:a.jrsOrganization,reportUri:a.reportUri,params_plan:a.params_plan};$("button").hide();visualizeDashboard.init()},init:function init(){$.getScript(utils.jrsUrl+"/client/visualize.js",function(){visualizeDashboard.launchVisualizeJs()})},launchVisualizeJs:function launchVisualizeJs(){console.log("Entramos en launchVisualizeJs");visualize({server:utils.jrsUrl,auth:{name:utils.jrsUsername,password:utils.jrsPassword,organization:utils.jrsOrganization}},function(a){JRSClient=a;visualizeDashboard.collectReportProperties({container:"#main",params:{},linkOptions:{beforeRender:function(b){b.forEach(visualizeDashboard.showCursor)},events:{click:function(b,d){if(d.type=="ReportExecution"){for(var c in d.parameters){if(c=="_report"){console.log("result converttoreportparams");console.log(visualizeDashboard.convertToReportParams(d.parameters));visualizeDashboard.openInNewTab({resource:d.parameters._report,params:visualizeDashboard.convertToReportParams(d.parameters)})}}}console.log(d)}}},error:function(b){alert(b.message)},success:function(){visualizeDashboard.buildParamsInput()}})},function(){alert("Unexpected error!")});console.log("Terminamos en launchVisualizeJs")},collectReportProperties:function collectReportProperties(c){var a=false;console.log("vamos a findreportproperties");var b=visualizeDashboard.findReportProperties(location.href);console.log(b);if(!b.hasOwnProperty("resource")){b.resource=utils.reportUri;a=true}c=_.extend(c,b);$.each(utils.params_plan,function(d,e){va=[];va.push(e.value);c.params[e.name]=va});console.log(c);if(a){JRSPreview=JRSClient.dashboard(c)}else{JRSPreview=JRSClient.report(c)}},convertToReportParams:function convertToReportParams(a){return _.chain(a).pairs().map(function(c){var b=c[0],d=c[1];if(!_.isArray(d)){return[b,[d]]}return c}).object().value()},findReportProperties:function findReportProperties(c){var a=document.createElement("a");a.href=c;var d=a.search,b={};console.log("los parametros de la url son");console.log(d);if(d){console.log("pasamos dentro de los parametros");b=visualizeDashboard.paramsFromUrlQueryParams(d)}console.log("result findReportProperties");console.log(b);return b},openInNewTab:function openInNewTab(b){var a=false;var c=_.reduce(b,function(e,f,d){if(!a){e+="?";a=true}if(_.isObject(f)&&d=="params"){e=e+visualizeDashboard.paramsToUrlQueryParams(f)}else{e=e+d+"="+f+"&"}return e},location.href);window.open(c,"_blank","width=800,height=800")},paramsToUrlQueryParams:function paramsToUrlQueryParams(a){return _.pairs(a).reduce(function(b,c){var d=c[0],e=c[1];if(_.isArray(e)){b=e.reduce(function(f,g){return f+"params:"+d+"="+g+"&"},b)}else{b=b+"params:"+d+"="+e+"&"}return b},"")},paramsFromUrlQueryParams:function paramsFromUrlQueryParams(c){c=decodeURI(c);var b={};var a=c.split("?");c="?"+a[a.length-1];if(c&&!_.isEmpty(c)){b=c.substr("1",c.length).split("&").reduce(function(f,g){var d=g.split("="),e=d[0],i=d[1];if(e!="id"){if(f[e]){f[e].push(i)}else{if(e.indexOf("params:")==0){if(!f.params){f.params={}}var h=e.replace("params:","");if(!f.params[h]){f.params[h]=[]}f.params[h].push(i)}else{if(!_.isEmpty(e)){f[e]=i}}}}return f},{})}$.each(utils.params_plan,function(d,e){va=[];va.push(e.value);b.params[e.name]=va});console.log("PARAMETROS OBTENIDOS DE URL");console.log(b);return b},showCursor:function showCursor(b){var a=b.element},buildParamsInput:function buildParamsInput(){$("button").hide();$("#container_preview_params").html("");var a=true;JRSClient.inputControls({resource:JRSClient.resource,success:function(c){$.each(c,function(g,f){console.log(c);a=false;if(f.visible==true){var h={id:f.id,label:f.label,type:f.type,options:[]};if("options" in f.state){$.each(f.state.options,function(){var m={label:this.label,value:this.value};h.options.push(m)})}var j=0;if(h.hasOwnProperty("options")){j=h.options.length}var d;var e;switch(h.type){case"singleSelect":case"singleSelectRadio":d="<select/>";e={id:h.id,name:h.id,type:"select-one","data-param-id":h.id};break;case"multiSelectCheckbox":case"multiSelect":d="<select/>";e={id:h.id,name:h.id,type:"select-multiple",multiple:"multiple","data-param-id":h.id};break;case"singleValueDatetime":case"singleValueDate":d="<input/>";e={id:h.id,name:h.id,label:h.label,type:"date","data-param-id":h.id};break;default:d="<input/>";e={id:h.id,type:h.type,"data-param-id":h.id}}var l="<label>{label}</label>",i=l.replace("{label}",h.label);$("#container_preview_params").append($(i));var k=$(d,e).appendTo("#container_preview_params");$("#container_preview_params").append("</br>");switch(h.type){case"singleSelect":case"singleSelectRadio":case"multiSelectCheckbox":case"multiSelect":$.each(h.options,function(){k.append($("<option />",{value:this.value,text:this.label}))});break}}})}});function b(c){alert(c.message)}if(!a){$("button").show()}console.log("Terminamos displayReportLoad")},applyFiltersPreviewReport:function applyFiltersPreviewReport(){var b={};$("[data-param-id]").each(function(d,e){var c=$(e).val();if(c!==null&e.localName=="select"){if(Array.isArray(c)){b[$(e).attr("data-param-id")]=c}else{var f=[];f.push($(e).val());b[$(e).attr("data-param-id")]=f}console.log("pasa por select");console.log($(e))}else{if(c!==null&e.localName=="input"){var f=[];f.push($(e).val());b[$(e).attr("data-param-id")]=f;console.log("pasa por input")}}});$.each(utils.params_plan,function(c,d){va=[];va.push(d.value);b[d.name]=va});console.log("PAR√ÅMETROS DASHBOARD");console.log(b);JRSPreview.params(b).run().fail(a);function a(c){alert(c.message)}},};