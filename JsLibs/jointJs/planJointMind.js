joint.shapes.html={};joint.shapes.html.Element=joint.shapes.basic.Rect.extend({defaults:joint.util.deepSupplement({type:"html.Element",attrs:{rect:{stroke:"none","fill-opacity":0}}},joint.shapes.basic.Rect.prototype.defaults)});joint.shapes.html.ElementView=joint.dia.ElementView.extend({template:['<div class="html-element" style="display:table-row">','<span class="button hideshow">&nbsp;</span>','<div class="cabecera">','	<div class="modalmenu" >','		<div class="close_contenedor" ><img class="close" src="./iconos/184.png" ></div>','		<div class="button addnew">Añadir hijo</div>','		<div class="button addnext">Añadir contiguo</div>','		<div class="button edit" >Editar</div>','		<div class="separator"></div>','		<div class="button organize" >Reorganizar</div>','		<div class="separator"></div>','		<div class="button delete">Eliminar</div>','		<div class="separator"></div>','		<div class="button undo">Deshacer</div>','		<div class="button redo">Rehacer</div>','		<div class="separator"></div>','		<div class="button export">Descargar</div>',"	</div></div>","<label></label>",'<textarea class="txtInput" style="width:100%" value="" ></textarea>',"<div><select><option>--</option><option>one</option><option>two</option></select>",'<div class="hidd" style="display:none"></div>',"</div></div>"].join(""),initialize:function(){_.bindAll(this,"updateBox");joint.dia.ElementView.prototype.initialize.apply(this,arguments);this.$box=$(_.template(this.template)());this.$box.find("textarea,select,a").on("mousedown click",function(d){d.stopPropagation()});this.$box.find("textarea").on("change",_.bind(function(d){joint_actualizar(this)},this));this.$box.find("textarea").on("blur",_.bind(function(d){joint_lostfocus(this)},this));if(!(EsExplorer()||EsEdge())){this.$box.find("textarea").on("keyup",_.bind(function(d){joint_ajustaTamanioXtextArea(this)},this))}this.$box.find("select").on("change",_.bind(function(d){this.model.set("select",$(d.target).val())},this));this.$box.find("select").val(this.model.get("select"));this.$box.find(".delete").on("click",_.bind(function(d){joint_borrar(this);joint_contextMenuHide()},this));this.$box.find(".hideshow").on("click",_.bind(function(d){joint_hideshow(this)},this));this.$box.find(".addnew").on("click",_.bind(function(d){joint_crearNuevo(this);joint_contextMenuHide()},this.model));this.$box.find(".addnext").on("click",_.bind(function(d){joint_crearHermano(this);joint_contextMenuHide()},this.model));this.$box.find(".edit").on("click",_.bind(function(d){joint_editar(this);joint_contextMenuHide()},this));this.$box.find(".undo").on("click",_.bind(function(d){joint_undoV(this);joint_contextMenuHide()},this));this.$box.find(".redo").on("click",_.bind(function(d){joint_redoV(this);joint_contextMenuHide()},this));this.$box.find(".export").on("click",_.bind(function(d){joint_export(this);joint_contextMenuHide()},this));this.$box.find(".organize").on("click",_.bind(function(d){joint_organize(this);joint_contextMenuHide()},this));this.$box.find(".cabecera .modalmenu").mouseleave(function(){$(this).parent().parent()[0].style.zIndex="2";$(this).parent().hide()});this.$box.find(".close").on("click",_.bind(function(d){joint_contextMenuHide(this)},this));this.model.on("change",this.updateBox,this);this.model.on("remove",this.removeBox,this);this.model.on("add",this.addBox,this);this.model.on("edit",this.editBox,this);this.$box.find(".html-element").prevObject.get(0).id="H"+this.model.id;this.model.myView=this;this.updateBox()},render:function(){joint.dia.ElementView.prototype.render.apply(this,arguments);this.paper.$el.prepend(this.$box);this.updateBox();joint_ajustaTamanio(this);return this},updateBox:function(){var f=this.model.graph;var q=this.model.get("primero");if(q){this.$box.find(".delete").remove()}var d=this.model.getBBox();this.$box.find("label").html(joint_textarea2HTML(this.model.get("label")));this.$box.find("hidd").html(joint_textarea2HTML(this.model.get("hidd")));this.$box.find("textarea").val(this.model.get("label"));this.$box.display="inline";var h=getLevel(this.model,0);if(h==0&&!q){h=999}this.$box.addClass("level"+h);this.$box.css({width:d.width,height:d.height,left:d.x,top:d.y,transform:"rotate("+(this.model.get("angle")||0)+"deg)"});if(this.model.graph.edit){if(this.model.graph.edit.id==this.model.id){this.$box.find(".edit").click()}}this.$box.removeClass("jointCollapsed");this.$box.removeClass("jointExpanded");if(joint_haveSucessors(this.model)){if(joint_isCollapsed(this.model)){this.$box.addClass("jointCollapsed")}else{this.$box.addClass("jointExpanded")}}this.$box.find(".button.addnew").text(f.literals.lnew);this.$box.find(".button.addnext").text(f.literals.lnext);this.$box.find(".button.edit").text(f.literals.ledit);this.$box.find(".button.organize").text(f.literals.lorganize);this.$box.find(".button.delete").text(f.literals.ldel);this.$box.find(".button.undo").text(f.literals.lundo);this.$box.find(".button.redo").text(f.literals.lredo);this.$box.find(".button.export").text(f.literals.ldownload)},removeBox:function(d){this.$box.remove()},hideBox:function(d){this.$box.hide()},showBox:function(d){this.$box.show()},addBox:function(d){alert(3)},editBox:function(d){alert("EditBox")},primero:false,collapsedContent:null});var joint_move=false;var joint_timer=null;var joint_paperMove=false;var joint_dim=[{width:200,height:50,sep:100,sepx:100},{width:160,height:50,sep:60,sepx:100},{width:150,height:30,sep:40,sepx:80},{width:150,height:30,sep:20,sepx:80}];function joint_getDims(f,h){var d=getLevel(f,0);d+=(h?h:0);return joint_dim[(d>3?3:d)]}function joint_export(f){var d=$("#"+f.model.graph.myControl).get(0);domtoimage.toPng(d).then(function(q){var h=$("<a>").attr("href",q).attr("download",d.id+"_image.png").appendTo("body");h[0].click();h.remove()}).catch(function(h){console.error("something went wrong!",h)})}function joint_borrar(d,f){joint_borrarModel(d.model,f)}function joint_borrarModel(x,z){if(x.primero){return false}if(x.attributes.primero){return false}if(x.graph.edit){return false}var s=x.graph;joint_stack(s);var C=joint_getSubGraph(x);var y=joint_getPadre(x);var h=joint_subGraphDimension(C);var r=joint_restOfGraph(s,C);var B=joint_getSupOf(x,r);var v=joint_getInfOf(x,r);var f=joint_subGraphDimension(B);var d=joint_subGraphDimension(v);var w=joint_getDims(x);var q=d.y-(f.y+f.height+((B.length>0&&v.length>0)?w.sep:0));if(!z){for(var t=0;t<C.length;t++){C[t].remove()}}s.selectedElement=y;if(q>0){var A=q/2;joint_redimensionar(B,0,(+A));joint_redimensionar(v,0,(-A))}joint_actualizaSeleccion(s);joint_status2Plan(s);return true}function joint_hideshow(w){var x=w.model;if(x.graph.edit){joint_forcelostfocus()}var h=x.graph.getSuccessors(x);if(h.length>0){joint_stack(x.graph);var s=joint_isCollapsed(x);if(!s){var d=[];for(var r=0;r<h.length;r++){var f=h[r];var v=joint_getSourceLink(f);if(x.graph.selectedElement){if(x.graph.selectedElement.id==f.id){x.graph.selectedElement=null;joint_actualizaSeleccion(x.graph)}}if($("#H"+f.id).css("display")!="none"){var t={id:f.id,lkId:null};d.push(t);$("#H"+f.id).hide();if(v){t.lkId=v.id;$("g[model-id="+v.id+"]").hide()}}}x.set("collapsedContent",d)}else{var q=x.get("collapsedContent");for(var r=0;r<q.length;r++){var t=q[r];$("#H"+t.id).show();$("g[model-id="+t.lkId+"]").show()}x.set("collapsedContent",[])}}else{x.set("collapsedContent",null)}w.updateBox();joint_status2Plan(x.graph)}function joint_isCollapsed(f){if(f.graph.getSuccessors(f).length<=0){return false}var d=f.get("collapsedContent");if(!d){return false}return(d.length>0)}function joint_isSoonOfCollapsed(d){var f=joint_getPadre(d);if(!f){return false}if(joint_isCollapsed(f)){return true}return joint_isSoonOfCollapsed(f)}function joint_restoreCollapsed(h){var f=h.getElements();for(e=0;e<f.length;e++){if(joint_isCollapsed(f[e])){var d=f[e].get("collapsedContent");for(var q=0;q<d.length;q++){var r=d[q];$("#H"+r.id).hide();$("g[model-id="+r.lkId+"]").hide()}}}if(h.selectedElement){$("#H"+h.selectedElement.id).addClass("selected")}if(!h.edit){joint_paperFocus($("#"+h.myControl).get(0),h)}}function joint_organize(s){var q=s.model.graph;joint_forcelostfocus(q,null);joint_stack(q);var h=q.getFirstCell();joint_organizeR(10,10,h);var d=q.getElements();var f=joint_subGraphDimension(d);var r=document.getElementById(q.myControl).offsetHeight;if(f.height<r){joint_redimensionar(d,0,(r-f.height)/2)}joint_ajustePaper(q);joint_actualizaSeleccion(q);joint_status2Plan(q);joint_scrollTo(h)}function joint_organizeR(F,H,r){var t=r.graph;var I=0;var h;var d=0;var D=0;var f=t.getSuccessors(r);var v=0;var s=[];for(v;v<f.length;v++){if(!joint_haveSucessors(f[v])){h=joint_getDims(f[v],0);d=f[v].get("size").height;D=h.sep;I+=d+D}}var B=F;if(f.length==0){var C=H}else{var C=(I/2)+H}r.position(B,C);var x=0;var z=B+r.attributes.size.width+joint_getDims(r,0).sepx;var A=H;var w=getInmediateSuccessors(r);for(x;x<w.length;x++){var q=w[x];joint_organizeR(z,A,q);var E=joint_subGraphDimension(joint_getSubGraph(q));A+=joint_getDims(q,0).sep+E.height}}function joint_editar(d){var f=d.model;d.$box.find("label").css("display","none");if(EsExplorer()){d.$box.find("textarea").css("display","inline-block").focus()}else{d.$box.find("textarea").css("display","inline-block").focus().select()}f.graph.edit=f}function joint_actualizar(f){var d=f.$box.find("textarea").val();f.$box.find("label").html(joint_textarea2HTML(d));f.model.set("label",d);joint_status2Plan(f.model.graph)}function joint_desactualizar(f){var d=f.get("label");f.myView.$box.find("textarea").val(d);f.myView.$box.find("label").html(joint_textarea2HTML(d))}function joint_undoEdit(f){var d=f.getElements();for(ii=0;ii<d.length;ii++){if(d[ii].myView){if(d[ii].myView.$box.find("textarea").css("display")!="none"){joint_desactualizar(d[ii])}}}}function joint_forcelostfocus(q,f){var d=null;if(f){d=f.id}else{q.edit=null}var h=q.getElements();for(ii=0;ii<h.length;ii++){if(d!=h[ii].id){joint_lostfocus(h[ii].myView)}}joint_paperFocus($("#"+q.myControl).get(0),q)}function joint_lostfocus(f){var h=f.model;var d=h.graph;if(f.$box.find("textarea").css("display")=="none"){return}joint_actualizar(f);f.$box.find("textarea").css("display","none");f.$box.find("label").css("display","inline-block");joint_ajustaTamanio(f);d.edit=null;joint_status2Plan(d);joint_paperFocus($("#"+d.myControl).get(0),d)}function joint_lineBreak(h){if(!h.edit){return}var f=h.getElements();for(o=0;o<f.length;o++){if(f[o].myView){var r=f[o].myView;if(r.$box.find("textarea").css("display")!="none"){var s=r.$box.find("textarea");var d=s.val();var q=s.prop("selectionStart");if(q>=0&&d.length>q){d=d.substring(0,q)+"\n"+d.substring(q,d.length)}else{d+="\n"}s.val(d);s.prop("selectionStart",q+1);s.prop("selectionEnd",q+1)}}}}function joint_removeCSSXLevel(d){for(l=0;l<100;l++){d.$box.removeClass("level"+l)}}function joint_HTML2Textarea(d){if(d){return d.split("<br/>").join("\n").split("&lt;br/&gt;").join("\n")}else{return""}}function joint_textarea2HTML(d){if(d){return d.split("\n").join("<br/>").split("&lt;br/&gt;").join("<br/>")}else{return""}}function getInmediateSuccessors(f){var d=f.graph.getSuccessors(f,{breadthFirst:true,depth:false});var h=[];for(i=0;i<d.length;i++){if(f.graph.isNeighbor(f,d[i])){h.push(d[i])}}return h}function getInmediatePredecessors(f){var d=f.graph.getPredecessors(f,{breadthFirst:true,depth:false});var h=[];for(i=0;i<d.length;i++){if(f.graph.isNeighbor(f,d[i])){h.push(d[i])}}return h}function getLevel(h,f){if(f===null){f=0}var q=h.graph.getFirstCell();if(h===q){return f}var d=getInmediatePredecessors(h);for(i=0;i<d.length;i++){return getLevel(d[i],f+1)}return 0}function joint_getPadre(d){var f=d.graph.getNeighbors(d,{inbound:true,outbound:false});if(f.length>0){return f[0]}return null}function joint_getXid(h,d){var f=h.getCells();for(Xid=0;Xid<f.length;Xid++){if(f[Xid].id==d){return f[Xid]}}}function array_push(d,f){for(a=0;a<f.length;a++){d.push(f[a])}}function joint_sortY(d){if(!d){return null}d.sort(function(f,h){if(f){return f.attributes.position.y-h.attributes.position.y}});return d}function joint_getXlevel(f,h){var d=f.getElements();var q=[];for(m=0;m<d.length;m++){if(getLevel(d[m],0)==h){q.push(d[m])}}return joint_sortY(q)}function joint_getPrev(d){var f=joint_getXlevel(d.graph,getLevel(d,0));for(n=0;n<f.length;n++){if(f[n].id==d.id){if(n>0){return f[n-1]}}}return null}function joint_getPost(d){var f=joint_getXlevel(d.graph,getLevel(d,0));for(n=0;n<f.length;n++){if(f[n].id==d.id){if(n<(f.length-1)){return f[n+1]}}}return null}function joint_childOf(d,f){pre=d.graph.getPredecessors(d);for(b=0;b<pre.length;pre++){if(pre[b].id==f.id){return true}}return false}function joint_haveSucessors(d){var f=d.graph.getSuccessors(d);if(f){return(f.length>0)}return false}function joint_getSourceLink(f){var d=f.graph.getLinks();for(n=0;n<d.length;n++){if(d[n].attributes.target.id==f.id){return d[n]}}return null}function joint_getSubGraph(f){var d=f.graph.getSuccessors(f);d.unshift(f);return d}function joint_restOfGraph(h,f){var d=h.getElements();var q=[];for(m=0;m<d.length;m++){if(!joint_subGraphContains(f,d[m].id)){q.push(d[m])}}return joint_sortY(q)}function joint_subGraphContains(f,d){for(n=0;n<f.length;n++){if(f[n].id==d){return true}}return false}function joint_subGraphDimension(d){if(!d){d=[]}if(d.length==0){return{width:0,height:0,x:0,y:0}}var w=null;var q=-999999;var s=-999999;var t=999999;var v=999999;for(n=0;n<d.length;n++){var f=d[n];var y=f.get("position").x;var z=f.get("position").y;var x=f.get("size").width;var h=f.get("size").height;if(!w){w={width:x,height:h,x:y,y:z}}if(q<=y+x){q=y+x}if(s<=z+h){s=z+h}if(t>=y){t=y}if(v>=z){v=z}}return{width:q-t,height:s-v,x:t,y:v}}function centroH(d){var f=document.getElementById(d).offsetHeight;return(f/2)-(joint_dim[0].height/2)}function joint_stack(d){if(d.pilas){d.pilas.PUndo.add(joint_serialize(d));d.pilas.PRedo.removeAll()}}function joint_undoV(d){joint_undo(d.model.graph)}function joint_undo(d){if(!d.pilas){return}var f=d.pilas.PUndo.pop();if(f){d.pilas.PRedo.add(joint_serialize(d));joint_deserialize(d,f);joint_status2Plan(d)}}function joint_redoV(d){joint_redo(d.model.graph)}function joint_redo(d){if(!d.pilas){return}previus=d.pilas.PRedo.pop();if(previus){d.pilas.PUndo.add(joint_serialize(d));joint_deserialize(d,previus);joint_status2Plan(d)}}function joint_status2Plan(d){if(d){var f=JSON.stringify(d);$("#"+d.myControlVal).val(f);return f}}function joint_serialize(f){var d=f.pilas;f.pilas={};var h=JSON.stringify(f);joint_status2Plan(f);f.pilas=d;return h}function joint_deserialize(r,d){var f=r.pilas;var q=r.selectedElement;var h=r.myControl;r.clear();r.fromJSON(JSON.parse(d));r.edit=null;r.pilas=f;r.myControl=h;r.selectedElement=q;joint_restoreCollapsed(r);joint_restoreSelected(r);joint_actualizaSeleccion(r);joint_ajustePaper(r)}function joint_findXid(f,h){var d=f.getElements();for(i=0;i<d.length;i++){if(d[i].id==h){return d[i]}}return null}function Stack(){var f=[];this.add=d;this.pop=r;this.getTopElement=h;this.hasElements=q;this.removeAll=s;this.size=t;function d(v){f.push(v)}function r(){return f.pop()}function h(){return f[f.length-1]}function q(){return f.length>0}function s(){f=[]}function t(){return f.length}}function joint_restoreSelected(d){if(d.selectedElement){d.selectedElement=joint_findXid(d,d.selectedElement.id)}}function joint_actualizaSeleccion(f){var d=f.getElements();for(i=0;i<d.length;i++){$("#H"+d[i].id).removeClass("selected")}if(f.selectedElement){$("#H"+f.selectedElement.id).addClass("selected")}joint_paperFocus($("#"+f.myControl).get(0),f)}function joint_clickOnCellView(d){d.model.graph.edit=null;$(".html-element textarea:focus").blur();d.model.graph.selectedElement=d.model;joint_actualizaSeleccion(d.model.graph);joint_forcelostfocus(d.model.graph,d.model)}function joint_arrow(d,f){if(!d.selectedElement){return}switch(f){case 37:p=joint_getPadre(d.selectedElement);if(p){d.selectedElement=p}break;case 38:prev=joint_getPrev(d.selectedElement);if(prev){d.selectedElement=prev}break;case 39:sigs=joint_sortY(getInmediateSuccessors(d.selectedElement));if(sigs){if(sigs.length>0){d.selectedElement=sigs[0]}}break;case 40:post=joint_getPost(d.selectedElement);if(post){d.selectedElement=post}break;case 35:var h=joint_getXlevel(d.selectedElement.graph,getLevel(d.selectedElement,0));if(h.length>0){d.selectedElement=h[h.length-1]}break;case 36:var h=joint_getXlevel(d.selectedElement.graph,getLevel(d.selectedElement,0));if(h.length>0){d.selectedElement=h[0]}break}joint_actualizaSeleccion(d)}function joint_redimensionar(f,h,q){for(j=0;j<f.length;j++){var d=f[j];d.translate(h,q)}}function joint_ajustePaper(f){if(!f){return}els=f.getElements();var v=0;var w=0;var h=0;for(k=0;k<els.length;k++){var d=els[k];var q=joint_getDims(d);if(v<d.get("position").x+d.get("size").width+q.sepx){var v=d.get("position").x+d.get("size").width+q.sepx}if(w<d.get("position").y+d.get("size").height+q.sep){var w=d.get("position").y+d.get("size").height+q.sep}if(h>d.get("position").y){h=d.get("position").y}}var r=document.getElementById(f.myControl);var s=r.clientWidth;var t=r.clientHeight;if(s<v){r.style.width=""+(v)+"px"}if(t<w){r.style.height=""+(w)+"px"}if(h<0){r.style.height=""+(r.clientHeight-(h))+"px";joint_redimensionar(els,0,-(h))}}function joint_getSupOf(h,f){var q=[];for(c=0;c<f.length;c++){var d=f[c];if(d.id==h.id){continue}if(d.get("position").y<h.get("position").y){q.push(d)}}return q}function joint_getInfOf(q,f){var h=[];for(c=0;c<f.length;c++){var d=f[c];if(d.id==q.id){continue}if(d.get("position").y>q.get("position").y){h.push(d)}}return h}function joint_hazHueco(h,q){var r=joint_getSubGraph(h);var d=joint_restOfGraph(h.graph,r);var s=joint_getSupOf(h,d);var f=joint_getInfOf(h,d);joint_redimensionar(s,0,(-q));joint_redimensionar(f,0,(+q))}function joint_scrollTo(f){var d=document.getElementById(f.graph.myControl).offsetTop;var h=document.getElementById("H"+f.id).offsetTop;document.getElementById(f.graph.myControl).scrollTop=(d-h)}function joint_ajustaTamanio(q){var d=false;var h=q.model.graph;var r=q.$box.get(0).clientHeight;var s=q.$box.find("label").get(0).clientHeight;if(s+20>r){q.model.get("size").height+=((s+20)-r);d=true}else{if(s+30<r){q.model.get("size").height+=((s+30)-r);d=true}}if(d){q.updateBox()}if(q.model.resizeX){var f=joint_serialize(h);joint_deserialize(h,f);q.model.resizeX=0}}function joint_ajustaTamanioXtextArea(h){var d=h.model.graph;var t=h.$box.find("textarea").get(0);var s=t.scrollWidth;var r=t.offsetWidth;if(!h.model.resizeX){h.model.resizeX=0}if(s>(r)){t.style.width=""+s+"px";var v=h.model.get("size").width;h.model.get("size").width=(s+20);h.model.resizeX=true;h.$box.css("width",""+(s+20)+"px")}else{var q=t.value;var w=joint_adjust2TextWidth(h,t);h.model.get("size").width=(w+20);h.model.resizeX=true;h.$box.css("width",""+(w+20)+"px")}var f=t.offsetWidth;console.log("....newtow>"+f+" tow ="+r);joint_redimensionar(d.getSuccessors(h.model),(f-r),0)}function joint_adjust2TextWidth(h,d){var q=d.offsetWidth;var f=joint_getDims(h.model,0).width;while(d.scrollWidth==d.offsetWidth&&d.offsetWidth>f){d.style.width=""+(d.offsetWidth-5)+"px";q=d.offsetWidth}d.style.width=""+(d.offsetWidth+5)+"px";return d.offsetWidth}function joint_crearNuevo(w){if(joint_isCollapsed(w)){joint_hideshow(w.myView)}joint_stack(w.graph);var z=w.graph.getSuccessors(w);var x=z.length;var r=getLevel(w,0);var s=joint_getDims(w,1);var q=(r==0?w.graph.literals.lmtopic:w.graph.literals.lsubtopic+" "+(r+1));var t=w.get("position").x+w.get("size").width+s.sepx;var v=w.get("position").y;for(h=0;h<x;h++){eH=(z[h].get("position").y+z[h].get("size").height);v=(eH>v?eH:v)}v+=(x>0?s.sep:(w.get("size").height-s.height)/2);var f=joint_crearHTMLElement(t,v,s.width,s.height,q,w.id,false);w.graph.addCells([f,joint_crearLink(w,f)]);var h=0;if(x>=1){var d=w.graph.getSuccessors(w);var y=((f.get("size").height+s.sep)/2);joint_redimensionar(d,0,(-y));joint_hazHueco(w,y)}joint_ajustePaper(w.graph);w.graph.selectedElement=f;joint_forcelostfocus(w.graph,f);joint_actualizaSeleccion(w.graph);w.graph.edit=f;if(f.myView){f.myView.updateBox()}if(w.myView){w.myView.updateBox()}joint_status2Plan(w.graph);joint_scrollTo(f)}function joint_crearHermano(d){var f=joint_getPadre(d);if(f){joint_crearNuevo(f)}}function joint_crearHTMLElement(v,w,t,h,r,q,s,f){var d=new joint.shapes.html.Element({position:{x:v,y:w},size:{width:t,height:h},label:r,bid:"H"+q,select:"two",primero:s,});return d}function joint_crearLink(h,d){var f=new joint.dia.Link({source:{id:h.id},target:{id:d.id},router:{name:"metro"},connector:{name:"rounded",args:{radius:100}},attrs:{".connection":{stroke:"#333","stroke-width":3},".marker-target":{fill:"#333",d:"M 10 0 L 0 5 L 10 10 z"},".link-tools":{display:"none"},".marker-vertices_NO":{display:"none"},".marker-arrowheads":{display:"none"},".connection-wrap":{display:"none"}},outPorts:["out"]});return f}function joint_changeParentNode(f,w){var s=f.model.graph;joint_forcelostfocus(s);var A=joint_getPadre(f.model);var h=s.getSuccessors(f.model);if(A){if(A.id==w.id){return false}}if(joint_subGraphContains(h,w.id)){return false}joint_borrar(f,true);var B=s.getSuccessors(w);var C=B.length;var v=getLevel(w,0);var x=joint_getDims(w,1);var y=w.get("position").x+w.get("size").width+x.sepx;var z=w.get("position").y;for(c=0;c<C;c++){eH=(B[c].get("position").y+B[c].get("size").height);z=(eH>z?eH:z)}if(C>0){z+=x.sep;var d=joint_getSubGraph(f.model);var r=joint_subGraphDimension(d);var q=r.height/2;z+=q}else{z+=(w.get("size").height-x.height)/2}var D=y-f.model.get("position").x;var E=z-f.model.get("position").y;var t=joint_getSourceLink(f.model);if(t){t.remove()}s.addCells(joint_crearLink(w,f.model));if(A){if(A.myView){A.myView.updateBox()}}if(w){if(w.myView){w.myView.updateBox()}}joint_removeCSSXLevel(f);f.updateBox();f.model.translate(D,E);for(u=0;u<h.length;u++){if(h[u].myView){joint_removeCSSXLevel(h[u].myView);h[u].myView.updateBox()}h[u].translate(D,E)}s.selectedElement=f.model;joint_actualizaSeleccion(s);f.$box.find(".html-element").focus();joint_status2Plan(s);joint_scrollTo(f.model);return true}function joint_rebuildGraph(f){if(!f){return}var d=jQuery.data(document.body,f);if(!d){return}if(d.pendiente){if(!$("#"+d.myControl).is(":hidden")){jQuery.data(document.body,f,joint_newGraph(d.myControl,d.myControlVal,d.pW,d.pH,d.literals,d.sl))}}}function joint_paperFocus(d,f){if(!f.edit){$(d).focus()}}function joint_setSl(h,q){if(!h){return}var d=jQuery.data(document.body,h);if(!d){return}if(d.sl==q){return}d.sl=(q?true:false);var f=($("#"+d.myControl).is(":hidden"));if(!f){d.clear();jQuery.data(document.body,h,joint_newGraph(d.myControl,d.myControlVal,d.pW,d.pH,d.literals,d.sl))}else{d.pendiente=true;d.clear()}}function joint_contextMenu(d,f,h){joint_contextMenuHide();d.$box[0].style.zIndex=3;d.$box.find(".cabecera").show();d.$box.find(".cabecera .modalmenu")[0].style.left=""+(f-5-d.model.get("position").x)+"px";d.$box.find(".cabecera .modalmenu")[0].style.top=""+(h-5-d.model.get("position").y)+"px"}function joint_contextMenuHide(){$(".html-element .cabecera .modalmenu").mouseleave();joint_timer=null}function joint_newGraph(f,h,y,v,s,z){var q=new joint.dia.Graph();q.selectedElement=null;q.firstElement=null;q.myControl=f;q.myControlVal=h;q.pW=y;q.pH=v;q.sl=(z?true:false);if(!s){s={lnew:"Añadir hijo",lnext:"Añadir contiguo",ledit:"Editar",lorganize:"Reorganiza mapa",ldel:"Eliminar",lundo:"Deshacer acción",lredo:"Rehacer acción",lctopic:"Tema central",lmtopic:"Tema principal",lsubtopic:"Subtópico",ldownload:"Descargar"}}q.literals=s;if(EsExplorer()||EsEdge()){$("#"+f).addClass("PtEx")}if($("#"+f).is(":hidden")){q.pendiente=true;return q}q.pendiente=false;var x=new Stack();var w=new Stack();var r=null;q.pilas={PUndo:x,PRedo:w,S:r};y=(y?y:800);v=(v?v:500);var t=new joint.dia.Paper({el:$("#"+f),width:y,height:v,gridSize:10,model:q});if(q.sl){t.setInteractivity(false);$("#"+q.myControl).removeAttr("tabindex").off("keypress").off("mouseover").off("keydown").off("keypress")}else{t.on("cell:contextmenu",function(B,C,D,E){joint_contextMenu(B,D,E)});t.on("cell:pointerdown",function(B,C,D,E){B.miX=D;B.miY=E;joint_timer=Date.now()});t.on("cell:pointermove",function(B,D,E,F){if(!joint_move){joint_stack(B.model.graph);joint_forcelostfocus(B.model.graph)}joint_move=true;joint_timer=null;var C=B.model.graph.getSuccessors(B.model);mx=B.model.attributes.position.x;my=B.model.attributes.position.y;if(!B.miX){return}tx=E-B.miX;ty=F-B.miY;B.miX=E;B.miY=F;for(cont=0;cont<C.length;cont++){C[cont].translate(tx,ty)}});t.on("cell:pointerup",function(B,E,F,G){if(joint_move){joint_move=false;joint_status2Plan(B.model.graph);var D=B.model.graph.get("cells").find(function(H){if(H instanceof joint.dia.Link){return false}if(H.id===B.model.id){return false}if(H.getBBox().containsPoint(g.point(F,G))){return true}return false});if(D){if(!joint_changeParentNode(B,D)){joint_undo(B.model.graph)}}joint_ajustePaper(B.model.graph);joint_forcelostfocus(B.model.graph)}if(joint_timer){var C=Date.now()-joint_timer;if(C>500){joint_contextMenu(B,F,G)}joint_timer=null}joint_clickOnCellView(B)});t.on("cell:pointerdblclick",function(B,C,D,E){joint_editar(B)});t.on("cell:pointerclick",function(B,C,D){joint_clickOnCellView(B)});t.on("blank:pointerclick",function(B,C,D){$(".html-element textarea:focus").blur();joint_forcelostfocus(q);joint_contextMenuHide(this)});t.on("blank:pointerdown",function(B,C,D){joint_paperMove=true;joint_paperMoveX=C;joint_paperMoveY=D});t.on("blank:pointermove",function(D,G,H){if(!joint_paperMove){return}var E=$("body").parent().scrollLeft();var F=$("body").parent().scrollTop();var B=E+(joint_paperMoveX-G);var C=F+(joint_paperMoveY-H);joint_paperMoveX=G;joint_paperMoveY=H;$("body").parent().scrollLeft((B<0?0:B));$("body").parent().scrollTop((C<0?0:C))});t.on("blank:pointerup",function(B,C,D){joint_paperMove=false;joint_paperMoveX=0;joint_paperMoveY=0});$("#"+f).attr("tabindex",0).on("mouseover",function(){joint_paperFocus(this,q)}).on("keydown",function(B){if(B.which==45||B.keyCode==45){if(q.selectedElement){joint_forcelostfocus(q);joint_crearNuevo(q.selectedElement)}}if(B.which==46||B.keyCode==46){if(q.selectedElement){if(joint_borrarModel(q.selectedElement)){joint_forcelostfocus(q)}}}if((B.which==13||B.keyCode==13)&&(B.ctrlKey||B.shiftKey||B.altKey)){B.stopPropagation();B.preventDefault();if(q.edit){joint_lineBreak(q);B.shiftKey=false;return}return}if((B.which==13||B.keyCode==13)){B.stopPropagation();B.preventDefault();if(q.edit){q.edit=null;joint_forcelostfocus(q)}else{joint_crearHermano(q.selectedElement)}}if(B.which==27||B.keyCode==27){B.stopPropagation();B.preventDefault();if(q.edit){q.edit=null;joint_undoEdit(q)}joint_forcelostfocus(q)}if(B.which==37||B.keyCode==37){if(!q.edit){B.stopPropagation();B.preventDefault();joint_arrow(q,37)}}if(B.which==38||B.keyCode==38){if(!q.edit){B.stopPropagation();B.preventDefault();joint_arrow(q,38)}}if(B.which==39||B.keyCode==39){if(!q.edit){B.stopPropagation();B.preventDefault();joint_arrow(q,39)}}if(B.which==40||B.keyCode==40){if(!q.edit){B.stopPropagation();B.preventDefault();joint_arrow(q,40)}}if(B.which==35||B.keyCode==35){if(!q.edit){B.stopPropagation();B.preventDefault();joint_arrow(q,35)}}if(B.which==36||B.keyCode==36){if(!q.edit){B.stopPropagation();B.preventDefault();joint_arrow(q,36)}}});if(EsFirefox()){$("#"+f).on("keypress",function(B){console.log("Fk"+B.which+"FKC"+B.keyCode+"Ctrl"+B.ctrlKey);if(((B.which==90||B.keyCode==90)&&B.ctrlKey)){if(q){joint_undo(q);joint_forcelostfocus(q)}}if(((B.which==89||B.keyCode==89)&&B.ctrlKey)){if(q){joint_redo(q);joint_forcelostfocus(q)}}})}else{$("#"+f).on("keypress",function(B){console.log("k"+B.which+"KC"+B.keyCode);if(((B.which==26||B.keyCode==26)&&B.ctrlKey)||B.which==26){if(q){joint_undo(q);joint_forcelostfocus(q)}}if(((B.which==25||B.keyCode==25)&&B.ctrlKey)||B.which==25){if(q){joint_redo(q);joint_forcelostfocus(q)}}})}}var A=$("#"+q.myControlVal).val();if(A){joint_deserialize(q,A)}else{var d=centroH(f);q.firstElement=joint_crearHTMLElement(10,d,joint_dim[0].width,joint_dim[0].height,q.literals.lctopic,"X",true);q.firstElement.primero=true;q.firstElement.graph=q;q.firstElement.on("change:position",function(B){console.log(B.id,":",B.get("position"))});q.addCells([q.firstElement]);q.selectedElement=q.firstElement;joint_actualizaSeleccion(q);joint_status2Plan(q)}joint_stack(q);return q};