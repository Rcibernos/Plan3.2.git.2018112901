(function(a){var c="timeEntry";a.JQPlugin.createPlugin({name:c,defaultOptions:{appendText:"",showSeconds:false,unlimitedHours:false,timeSteps:[1,1,1],initialField:null,noSeparatorEntry:false,tabToExit:false,useMouseWheel:true,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:false,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null},regionalOptions:{"":{show24Hours:false,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]}},_getters:["getOffset","getTime","isDisabled"],_appendClass:c+"-append",_controlClass:c+"-control",_expandClass:c+"-expand",_disabledInputs:[],_instSettings:function(d,e){return{_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0}},_postAttach:function(d,e){d.on("focus."+e.name,this._doFocus).on("blur."+e.name,this._doBlur).on("click."+e.name,this._doClick).on("keydown."+e.name,this._doKeyDown).on("keypress."+e.name,this._doKeyPress).on("paste."+e.name,function(f){setTimeout(function(){b._parseTime(e)},1)})},_optionsChanged:function(e,f,g){var d=this._extractTime(f);a.extend(f.options,g);f.options.show24Hours=f.options.show24Hours||f.options.unlimitedHours;f._field=0;if(d){this._setTime(f,new Date(0,0,0,d[0],d[1],d[2]))}e.next("span."+this._appendClass).remove();e.parent().find("span."+this._controlClass).remove();if(a.fn.mousewheel){e.unmousewheel()}var h=(!f.options.spinnerImage?null:a('<span class="'+this._controlClass+'" style="display: inline-block; background: url(\''+f.options.spinnerImage+"') 0 0 no-repeat; width: "+f.options.spinnerSize[0]+"px; height: "+f.options.spinnerSize[1]+'px;"></span>'));e.after(f.options.appendText?'<span class="'+this._appendClass+'">'+f.options.appendText+"</span>":"").after(h||"");if(f.options.useMouseWheel&&a.fn.mousewheel){e.mousewheel(this._doMouseWheel)}if(h){h.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)}},enable:function(d){this._enableDisable(d,false)},disable:function(d){this._enableDisable(d,true)},_enableDisable:function(e,d){var f=this._getInst(e);if(!f){return}e.disabled=d;if(e.nextSibling&&e.nextSibling.nodeName.toLowerCase()==="span"){this._changeSpinner(f,e.nextSibling,(d?5:-1))}this._disabledInputs=a.map(this._disabledInputs,function(g){return(g===e?null:g)});if(d){this._disabledInputs.push(e)}},isDisabled:function(d){return a.inArray(d,this._disabledInputs)>-1},_preDestroy:function(d,e){d=a(d).off("."+c);if(a.fn.mousewheel){d.unmousewheel()}this._disabledInputs=a.map(this._disabledInputs,function(f){return(f===d[0]?null:f)});d.siblings("."+this._appendClass+",."+this._controlClass).remove()},setTime:function(d,f){var e=this._getInst(d);if(e){if(f===null||f===""){a(d).val("")}else{this._setTime(e,f?(a.isArray(f)?f:(typeof f==="object"?new Date(f.getTime()):f)):null)}}},getTime:function(e){var f=this._getInst(e);var d=(f?this._extractTime(f):null);return(!d?null:new Date(0,0,0,d[0],d[1],d[2]))},getOffset:function(e){var f=this._getInst(e);var d=(f?this._extractTime(f):null);return(!d?0:(d[0]*3600+d[1]*60+d[2])*1000)},_doFocus:function(d){var e=(d.nodeName&&d.nodeName.toLowerCase()==="input"?d:this);if(b._lastInput===e||b.isDisabled(e)){b._focussed=false;return}var f=b._getInst(e);b._focussed=true;b._lastInput=e;b._blurredInput=null;a.extend(f.options,(a.isFunction(f.options.beforeShow)?f.options.beforeShow.apply(e,[e]):{}));b._parseTime(f,d.nodeName?null:d);setTimeout(function(){b._showField(f)},10)},_doBlur:function(d){b._blurredInput=b._lastInput;b._lastInput=null},_doClick:function(d){var e=d.target;var f=b._getInst(e);var g=f._field;if(!b._focussed){f._field=b._getSelection(f,e,d)}if(g!==f._field){f._lastChr=""}b._showField(f);b._focussed=false},_getSelection:function(j,i,f){var m=0;var h=[j.elem.val().split(j.options.separator)[0].length,2,2];if(i.selectionStart!==null){var e=0;for(var g=0;g<=Math.max(1,j._secondField,j._ampmField);g++){e+=(g!==j._ampmField?h[g]+j.options.separator.length:j.options.ampmPrefix.length+j.options.ampmNames[0].length);m=g;if(i.selectionStart<e){break}}}else{if(i.createTextRange&&f!=null){var n=a(f.srcElement);var l=i.createTextRange();var d=function(o){return{thin:2,medium:4,thick:6}[o]||o};var k=f.clientX+document.documentElement.scrollLeft-(n.offset().left+parseInt(d(n.css("border-left-width")),10))-l.offsetLeft;for(var g=0;g<=Math.max(1,j._secondField,j._ampmField);g++){var e=(g!==j._ampmField?(g*fieldSize)+2:(j._ampmField*fieldSize)+j.options.ampmPrefix.length+j.options.ampmNames[0].length);l.collapse();l.moveEnd("character",e);m=g;if(k<l.boundingWidth){break}}}}return m},_doKeyDown:function(d){if(d.keyCode>=48){return true}var e=b._getInst(d.target);switch(d.keyCode){case 9:return(e.options.tabToExit?true:(d.shiftKey?b._changeField(e,-1,true):b._changeField(e,+1,true)));case 35:if(d.ctrlKey){b._setValue(e,"")}else{e._field=Math.max(1,e._secondField,e._ampmField);b._adjustField(e,0)}break;case 36:if(d.ctrlKey){b._setTime(e)}else{e._field=0;b._adjustField(e,0)}break;case 37:b._changeField(e,-1,false);break;case 38:b._adjustField(e,+1);break;case 39:b._changeField(e,+1,false);break;case 40:b._adjustField(e,-1);break;case 46:b._setValue(e,"");break;case 8:e._lastChr="";default:return true}return false},_doKeyPress:function(e){var d=String.fromCharCode(e.charCode===undefined?e.keyCode:e.charCode);if(d<" "){return true}var f=b._getInst(e.target);b._handleKeyPress(f,d);return false},_handleKeyPress:function(g,d){if(d===g.options.separator){this._changeField(g,+1,false)}else{if(d>="0"&&d<="9"){var h=parseInt(d,10);var l=parseInt(g._lastChr+d,10);var f=(g._field!==0?g._selectedHour:(g.options.unlimitedHours?l:(g.options.show24Hours?(l<24?l:h):(l>=1&&l<=12?l:(h>0?h:g._selectedHour))%12+(g._selectedHour>=12?12:0))));var i=(g._field!==1?g._selectedMinute:(l<60?l:h));var k=(g._field!==g._secondField?g._selectedSecond:(l<60?l:h));var e=this._constrainTime(g,[f,i,k]);this._setTime(g,(g.options.unlimitedHours?e:new Date(0,0,0,e[0],e[1],e[2])));if(g.options.noSeparatorEntry&&g._lastChr){this._changeField(g,+1,false)}else{g._lastChr=(g.options.unlimitedHours&&g._field===0?g._lastChr+d:d)}}else{if(!g.options.show24Hours){d=d.toLowerCase();if((d===g.options.ampmNames[0].substring(0,1).toLowerCase()&&g._selectedHour>=12)||(d===g.options.ampmNames[1].substring(0,1).toLowerCase()&&g._selectedHour<12)){var j=g._field;g._field=g._ampmField;this._adjustField(g,+1);g._field=j;this._showField(g)}}}}},_doMouseWheel:function(e,d){if(b.isDisabled(e.target)){return}var f=b._getInst(e.target);f.elem.focus();if(!f.elem.val()){b._parseTime(f)}b._adjustField(f,d);e.preventDefault()},_expandSpinner:function(d){var h=b._getSpinnerTarget(d);var e=b._getInst(b._getInput(h));if(b.isDisabled(e.elem[0])){return}if(e.options.spinnerBigImage){e._expanded=true;var f=a(h).offset();var g=null;a(h).parents().each(function(){var i=a(this);if(i.css("position")==="relative"||i.css("position")==="absolute"){g=i.offset()}return !g});a('<div class="'+b._expandClass+'" style="position: absolute; left: '+(f.left-(e.options.spinnerBigSize[0]-e.options.spinnerSize[0])/2-(g?g.left:0))+"px; top: "+(f.top-(e.options.spinnerBigSize[1]-e.options.spinnerSize[1])/2-(g?g.top:0))+"px; width: "+e.options.spinnerBigSize[0]+"px; height: "+e.options.spinnerBigSize[1]+"px; background: transparent url("+e.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(b._handleSpinner).mouseup(b._endSpinner).mouseout(b._endExpand).mousemove(b._describeSpinner).insertAfter(h)}},_getInput:function(d){return a(d).siblings("."+this._getMarker())[0]},_describeSpinner:function(d){var f=b._getSpinnerTarget(d);var e=b._getInst(b._getInput(f));f.title=e.options.spinnerTexts[b._getSpinnerRegion(e,d)]},_handleSpinner:function(d){var h=b._getSpinnerTarget(d);var e=b._getInput(h);if(b.isDisabled(e)){return}if(e===b._blurredInput){b._lastInput=e;b._blurredInput=null}var f=b._getInst(e);b._doFocus(e);var g=b._getSpinnerRegion(f,d);b._changeSpinner(f,h,g);b._actionSpinner(f,g);b._timer=null;b._handlingSpinner=true;if(g>=3&&f.options.spinnerRepeat[0]){b._timer=setTimeout(function(){b._repeatSpinner(f,g)},f.options.spinnerRepeat[0]);a(h).one("mouseout",b._releaseSpinner).one("mouseup",b._releaseSpinner)}},_actionSpinner:function(d,e){if(!d.elem.val()){b._parseTime(d)}switch(e){case 0:this._setTime(d);break;case 1:this._changeField(d,-1,false);break;case 2:this._changeField(d,+1,false);break;case 3:this._adjustField(d,+1);break;case 4:this._adjustField(d,-1);break}},_repeatSpinner:function(d,e){if(!b._timer){return}b._lastInput=b._blurredInput;this._actionSpinner(d,e);this._timer=setTimeout(function(){b._repeatSpinner(d,e)},d.options.spinnerRepeat[1])},_releaseSpinner:function(d){clearTimeout(b._timer);b._timer=null},_endExpand:function(d){b._timer=null;var g=b._getSpinnerTarget(d);var e=b._getInput(g);var f=b._getInst(e);a(g).remove();f._expanded=false},_endSpinner:function(d){b._timer=null;var g=b._getSpinnerTarget(d);var e=b._getInput(g);var f=b._getInst(e);if(!b.isDisabled(e)){b._changeSpinner(f,g,-1)}if(b._handlingSpinner){b._lastInput=b._blurredInput}if(b._lastInput&&b._handlingSpinner){b._showField(f)}b._handlingSpinner=false},_getSpinnerTarget:function(d){return d.target||d.srcElement},_getSpinnerRegion:function(f,e){var l=this._getSpinnerTarget(e);var i=a(l).offset();var k=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];var g=(f.options.spinnerIncDecOnly?99:e.clientX+k[0]-i.left);var n=e.clientY+k[1]-i.top;var m=f.options[f._expanded?"spinnerBigSize":"spinnerSize"];var j=(f.options.spinnerIncDecOnly?99:m[0]-1-g);var d=m[1]-1-n;if(m[2]>0&&Math.abs(g-j)<=m[2]&&Math.abs(n-d)<=m[2]){return 0}var h=Math.min(g,n,j,d);return(h===g?1:(h===j?2:(h===n?3:4)))},_changeSpinner:function(d,f,e){a(f).css("background-position","-"+((e+1)*d.options[d._expanded?"spinnerBigSize":"spinnerSize"][0])+"px 0px")},_parseTime:function(f,e){var d=this._extractTime(f);if(d){f._selectedHour=d[0];f._selectedMinute=d[1];f._selectedSecond=d[2]}else{var g=this._constrainTime(f);f._selectedHour=g[0];f._selectedMinute=g[1];f._selectedSecond=(f.options.showSeconds?g[2]:0)}f._secondField=(f.options.showSeconds?2:-1);f._ampmField=(f.options.show24Hours?-1:(f.options.showSeconds?3:2));f._lastChr="";var h=function(){if(f.elem.val()!==""){b._showTime(f)}};if(typeof f.options.initialField==="number"){f._field=Math.max(0,Math.min(Math.max(1,f._secondField,f._ampmField),f.options.initialField));h()}else{setTimeout(function(){f._field=b._getSelection(f,f.elem[0],e);h()},0)}},_extractTime:function(f,k){k=k||f.elem.val();var d=k.split(f.options.separator);if(f.options.separator===""&&k!==""){d[0]=k.substring(0,2);d[1]=k.substring(2,4);d[2]=k.substring(4,6)}if(d.length>=2){var g=!f.options.show24Hours&&(k.indexOf(f.options.ampmNames[0])>-1);var h=!f.options.show24Hours&&(k.indexOf(f.options.ampmNames[1])>-1);var e=parseInt(d[0],10);e=(isNaN(e)?0:e);e=((g||h)&&e===12?0:e)+(h?12:0);var i=parseInt(d[1],10);i=(isNaN(i)?0:i);var j=(d.length>=3?parseInt(d[2],10):0);j=(isNaN(j)||!f.options.showSeconds?0:j);return this._constrainTime(f,[e,i,j])}return null},_constrainTime:function(f,d){var j=(d!==null&&d!==undefined);if(!j){var g=this._determineTime(f.options.defaultTime,f)||new Date();d=[g.getHours(),g.getMinutes(),g.getSeconds()]}var h=false;for(var e=0;e<f.options.timeSteps.length;e++){if(h){d[e]=0}else{if(f.options.timeSteps[e]>1){d[e]=Math.round(d[e]/f.options.timeSteps[e])*f.options.timeSteps[e];h=true}}}return d},_showTime:function(e){var d=(e.options.unlimitedHours?e._selectedHour:this._formatNumber(e.options.show24Hours?e._selectedHour:((e._selectedHour+11)%12)+1))+e.options.separator+this._formatNumber(e._selectedMinute)+(e.options.showSeconds?e.options.separator+this._formatNumber(e._selectedSecond):"")+(e.options.show24Hours?"":e.options.ampmPrefix+e.options.ampmNames[(e._selectedHour<12?0:1)]);this._setValue(e,d);this._showField(e)},_showField:function(h){var g=h.elem[0];if(h.elem.is(":hidden")||b._lastInput!==g){return}var f=[h.elem.val().split(h.options.separator)[0].length,2,2];var j=0;var e=0;while(e<h._field){j+=f[e]+(e===Math.max(1,h._secondField)?0:h.options.separator.length);e++}var d=j+(h._field!==h._ampmField?f[e]:h.options.ampmPrefix.length+h.options.ampmNames[0].length);if(g.setSelectionRange){g.setSelectionRange(j,d)}else{if(g.createTextRange){var i=g.createTextRange();i.moveStart("character",j);i.moveEnd("character",d-h.elem.val().length);i.select()}}if(!g.disabled){g.focus()}},_formatNumber:function(d){return(d<10?"0":"")+d},_setValue:function(d,e){if(e!==d.elem.val()){d.elem.val(e).trigger("change")}},_changeField:function(e,g,f){var d=(e.elem.val()===""||e._field===(g===-1?0:Math.max(1,e._secondField,e._ampmField)));if(!d){e._field+=g}this._showField(e);e._lastChr="";return(d&&f)},_adjustField:function(d,e){if(d.elem.val()===""){e=0}if(d.options.unlimitedHours){this._setTime(d,[d._selectedHour+(d._field===0?e*d.options.timeSteps[0]:0),d._selectedMinute+(d._field===1?e*d.options.timeSteps[1]:0),d._selectedSecond+(d._field===d._secondField?e*d.options.timeSteps[2]:0)])}else{this._setTime(d,new Date(0,0,0,d._selectedHour+(d._field===0?e*d.options.timeSteps[0]:0)+(d._field===d._ampmField?e*12:0),d._selectedMinute+(d._field===1?e*d.options.timeSteps[1]:0),d._selectedSecond+(d._field===d._secondField?e*d.options.timeSteps[2]:0)))}},_setTime:function(e,h){if(e.options.unlimitedHours&&a.isArray(h)){var d=h}else{h=this._determineTime(h,e);var d=(h?[h.getHours(),h.getMinutes(),h.getSeconds()]:null)}d=this._constrainTime(e,d);h=new Date(0,0,0,d[0],d[1],d[2]);var h=this._normaliseTime(h);var g=this._normaliseTime(this._determineTime(e.options.minTime,e));var f=this._normaliseTime(this._determineTime(e.options.maxTime,e));if(e.options.unlimitedHours){while(d[2]<0){d[2]+=60;d[1]--}while(d[2]>59){d[2]-=60;d[1]++}while(d[1]<0){d[1]+=60;d[0]--}while(d[1]>59){d[1]-=60;d[0]++}g=(e.options.minTime!=null&&a.isArray(e.options.minTime))?e.options.minTime:[0,0,0];if(d[0]<g[0]){d=g.slice(0,3)}else{if(d[0]===g[0]){if(d[1]<g[1]){d[1]=g[1];d[2]=g[2]}else{if(d[1]===g[1]){if(d[2]<g[2]){d[2]=g[2]}}}}}if(e.options.maxTime!=null&&a.isArray(e.options.maxTime)){if(d[0]>e.options.maxTime[0]){d=e.options.maxTime.slice(0,3)}else{if(d[0]===e.options.maxTime[0]){if(d[1]>e.options.maxTime[1]){d[1]=e.options.maxTime[1];d[2]=e.options.maxTime[2]}else{if(d[1]===e.options.maxTime[1]){if(d[2]>e.options.maxTime[2]){d[2]=e.options.maxTime[2]}}}}}}}else{if(g&&f&&g>f){if(h<g&&h>f){h=(Math.abs(h-g)<Math.abs(h-f)?g:f)}}else{h=(g&&h<g?g:(f&&h>f?f:h))}d[0]=h.getHours();d[1]=h.getMinutes();d[2]=h.getSeconds()}if(a.isFunction(e.options.beforeSetTime)){h=e.options.beforeSetTime.apply(e.elem[0],[this.getTime(e.elem[0]),h,g,f]);d[0]=h.getHours();d[1]=h.getMinutes();d[2]=h.getSeconds()}e._selectedHour=d[0];e._selectedMinute=d[1];e._selectedSecond=d[2];this._showTime(e)},_determineTime:function(h,d){var f=function(i){var j=new Date();j.setTime(j.getTime()+i*1000);return j};var g=function(m){var i=b._extractTime(d,m);var p=new Date();var j=(i?i[0]:p.getHours());var l=(i?i[1]:p.getMinutes());var o=(i?i[2]:p.getSeconds());if(!i){var n=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g;var k=n.exec(m);while(k){switch(k[2]||"s"){case"s":case"S":o+=parseInt(k[1],10);break;case"m":case"M":l+=parseInt(k[1],10);break;case"h":case"H":j+=parseInt(k[1],10);break}k=n.exec(m)}}p=new Date(0,0,10,j,l,o,0);if(/^!/.test(m)){if(p.getDate()>10){p=new Date(0,0,10,23,59,59)}else{if(p.getDate()<10){p=new Date(0,0,10,0,0,0)}}}return p};var e=function(i){return new Date(0,0,0,i[0],i[1]||0,i[2]||0,0)};return(h?(typeof h==="string"?g(h):(typeof h==="number"?f(h):(a.isArray(h)?e(h):h))):null)},_normaliseTime:function(d){if(!d){return null}d.setFullYear(1900);d.setMonth(0);d.setDate(0);return d}});var b=a.timeEntry})(jQuery);