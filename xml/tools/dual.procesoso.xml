<form id="dual.procesoso" tablaanexa="DUAL" nbcampoid="DUMMY" nombreexterno="procesoso" nbbtablaoriginal="" ayuda="" sqlcamposvista="" dynaplantilla="" triggeralter="" estilo="" modocalculo="" nombrepadreid="" omitirpadreid="0" condiferencias="0" ncol="" version="3">
  <pa id="dual.procesoso|responsive" padreid="dual.procesoso" nombre="responsive" valor="1" sql="" />
  <pa id="dual.procesoso|responsivestatus" padreid="dual.procesoso" nombre="responsivestatus" valor="rev2pa" sql="" />
  <tab catalogformulariodesigner="dual.procesoso" id="2196" titulo="" cssclass="" orden="0">
    <bloque catalogformulariodesigner="dual.procesoso" id="2197" titulo="" cssclass="" ncol="12" primeroenlinea="0" padre="2196" visible="1" orden="1">
      <bloque catalogformulariodesigner="dual.procesoso" id="2267" titulo="" cssclass="" ncol="12" primeroenlinea="0" padre="2197" visible="1" orden="2">
        <elementodiseno id="2975" titulo="¬Crear nuevo proceso" catalogelementodiseno="2" ancho="7" alto="18" orden="1" ncol="4" primeroenlinea="0">
          <pa padreid="2975" nombre="cssclass" valor="PWButton" />
          <pa padreid="2975" nombre="msjconfirm" valor="¬Se va crear un nuevo tipo de proceso junto a sus tablas asociadas" />
          <calculo padreid="2975" tipo="2" calculo="/*[type=jscript]*/ &#xA;&#xA;var IdProceso;&#xA;var IdFase;&#xA;&#xA;$sys.trace('version BBDD: ' + $db.version);&#xA;if ($db.version == 11) {&#xA;    IdProceso = $db.executeSql(&quot;select max(Id)+1 from WF_CTPROCESO&quot;).getValue(0,0);&#xA;    $sys.trace('IdProceso: ' + IdProceso);&#xA;    $db.executeCommand(&quot;insert into WF_CTPROCESO (Id, Nombre, Activo, Publico) values (&quot; + IdProceso + &quot;, '¬Nuevo proceso', 1, 1)&quot;);&#xA;    &#xA;    IdFase = $db.executeSql(&quot;select max(Id)+1 from WF_CTFASE&quot;).getValue(0,0); &#xA;    $sys.trace('IdFase: ' + IdFase);&#xA;    $db.executeCommand(&quot;insert into WF_CTFASE (Id, Texto, Nivel, tipo_Rol, EsFinal, CATALOGFORMULARIODESIGNERREADO, Catalog_Proceso, x, y, Alto, Ancho, condiferencias, ModoValidacion, MomentoValidacion) values (&quot; + IdFase + &quot;, '¬Inicio', 0, 1, 0, 0, &quot; + IdProceso + &quot;, 4000, 300, 1500, 700, 0, 0, 0)&quot;);&#xA;} else {&#xA;    $db.executeCommand(&quot;insert into WF_CTPROCESO (Nombre, Activo, Publico) values ('¬Nuevo proceso', 1, 1)&quot;);&#xA;    IdProceso = $db.executeSql(&quot;select max(Id) from WF_CTPROCESO&quot;).getValue(0,0);&#xA;    $sys.trace('IdProceso: ' + IdProceso);&#xA;    &#xA;    $db.executeCommand(&quot;insert into WF_CTFASE (Texto, Nivel, tipo_Rol, EsFinal, CATALOGFORMULARIODESIGNERREADO, Catalog_Proceso, x, y, Alto, Ancho, condiferencias, ModoValidacion, MomentoValidacion) values ('¬Inicio', 0, 1, 0, 0, &quot; + IdProceso + &quot;, 4000, 300, 1500, 700, 0, 0, 0)&quot;);&#xA;    IdFase = $db.executeSql(&quot;select Id from WF_CTFASE where Catalog_Proceso = &quot; + IdProceso + &quot;;&quot;).getValue(0,0); &#xA;    $sys.trace('IdFase: ' + IdFase);&#xA;}&#xA;    &#xA;$db.executeCommand(&quot;update WF_CTPROCESO set FASE_INICIAL = &quot; + IdFase + &quot; where Id = &quot; + IdProceso);&#xA;&#xA;var contador = $db.count('user_tables', '*', 'where table_name = \'WF_PROCESO_' + IdProceso + '\'');&#xA;$sys.trace('contador: ' + contador);&#xA;if ($db.version == 11 &amp;&amp; contador &lt; 1 || $db.version == 12) {&#xA;        $db.executeCommand(&quot;CREATE TABLE WF_PROCESO_&quot; + IdProceso + &quot;(AGENDA NUMERIC(10,0) NOT NULL,&quot; + &quot; CONSTRAINT PK_WF_PROCESO_&quot; + IdProceso + &quot; PRIMARY KEY (Agenda))&quot;);&#xA;        $db.executeCommand(&quot;ALTER TABLE WF_PROCESO_&quot;+ IdProceso +&quot; ADD CONSTRAINT FK_WF_PROCESO_&quot; + IdProceso + &quot;_AG FOREIGN KEY(AGENDA) REFERENCES AGENDA (Id)&quot;);&#xA;} &#xA;&#xA;$this.PGS(&quot;OpenRepositorio&quot;, [51, 158, IdProceso, 0, 0]);" />
        </elementodiseno>
      </bloque>
      <bloque catalogformulariodesigner="dual.procesoso" id="2198" titulo="" cssclass="" ncol="12" primeroenlinea="1" padre="2197" visible="1" orden="3">
        <campo id="dual.procesoso|procesos" tipo="106" titulo="¬Todos los procesos" campo="PROCESOS" visible="1" sololectura="0" obligatorio="0" ancho="0" ayuda="¬Listado con todos los tipos de proceso en este proyecto" alto="840" etiqueta="2" tabla="WF_CTPROCESO" formulario_edicion="wf_ctproceso.procesoo" alto_formulario="0" ancho_formulario="0" limite_registros="25" formulario_columnas="wf_ctproceso.procesoo" con_bajas="0" modo_seleccion="0" contador_de_registros="0" exportar_a_excel="0" nivel_de_agrupacion="0" tamano_de_pagina="" modo_visualizar_formulario_emergente="1" modo_insercion_nuevos_registros="0" expandir_a_lo_alto="1" procedimiento_formulario_asincrono="" paginar_ver_todos="1" validar_grid_encambio_de_pagina="1" condicion="/*[type=SQL]*/&#xD;&#xA;WHERE 1=1" orderby="ORDER BY WF_CTPROCESO.id" accion_al_editar="/*[type=jscript]*/ &#xA;&#xA;$sys.trace('IdSelected: ' + $sys.idSelected);&#xA;$this.PGS(&quot;OpenRepositorio&quot;, [51, 158, $sys.idSelected, 0, 0]);" tipomacro="106" orden="1" ncol="12" primeroenlinea="1">
          <pa padreid="dual.procesoso|procesos" nombre="count_reg_txt" valor="¬Tipos de proceso" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="del_reg_ok" valor="¬El tipo de proceso se ha eliminado del proyecto" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="del_reg_tooltip" valor="¬Borrar el tipo de proceso con todos sus fases y bifurcaciones" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="del_reg_txt" valor="¬¿?" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="del_reg_txt_confirm" valor="¬Esta acción borrará el tipo de proceso y todas sus fases y bifurcaciones ¿Esta de acuerdo?" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="minwidth_px" valor="" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="new_reg_tooltip" valor="¬Añadir un nuevo tipo de proceso" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="new_reg_txt" valor="¬Añadir un nuevo tipo de proceso" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="no_filas_txt" valor="¬Texto sin datos" sql="" />
          <pa padreid="dual.procesoso|procesos" nombre="use_sqlcamposvista" valor="0" sql="" />
          <calculo padreid="dual.procesoso|procesos" tipo="102" bdtipo="102" calculo="/*[type=jscript]*/ &#xA;if($sys.db.count(&quot;wf_proceso&quot;,&quot;agenda&quot;,&quot;WHERE catalog_proceso=&quot;+$sys.idSelected)&gt;0)&#xA;{ $this.error='¬No se puede borrar el tipo de proceso. Tiene flujos abiertos'}" orden="0" asincrono="1" />
          <calculo padreid="dual.procesoso|procesos" tipo="111" bdtipo="111" calculo="/*[type=jscript]*/ &#xA;&#xA;$db.executeSql(&quot;DELETE FROM WF_CTNOTIFICACION_RESPUESTA WHERE EXISTS(SELECT * FROM WF_CTRESPUESTA r INNER JOIN WF_CTFASE f ON f.Id = r.Catalog_Fase_Origen WHERE r.Id = WF_CTNOTIFICACION_RESPUESTA.CATALOG_RESPUESTA AND f.Catalog_Proceso =&quot; + $sys.idSelected +&quot;)&quot;);&#xA;&#xA;$db.executeSql(&quot;DELETE FROM WF_CTRESPUESTA WHERE EXISTS (SELECT * FROM WF_CTFASE f WHERE f.Id = WF_CTRESPUESTA.Catalog_Fase_Origen AND f.Catalog_Proceso =&quot; + $sys.idSelected +&quot;)&quot;);&#xA;&#xA;$db.executeSql(&quot;DELETE FROM WF_CTPROCESOBOTON WHERE CatalogProceso =&quot; + $sys.idSelected);&#xA;&#xA;$db.executeSql(&quot;UPDATE WF_CTTIPOROLPARAMETRIZABLE SET CatalogProceso = NULL WHERE CatalogProceso =&quot; + $sys.idSelected);&#xA;&#xA;$db.executeSql(&quot;DELETE FROM WF_CTPROCESOAUTORIZADO WHERE CATALOGPROCESO=&quot; + $sys.idSelected);&#xA;&#xA;//$db.executeSql(&quot;UPDATE WF_CTPROCESO SET FASE_INICIAL=NULL WHERE ID=&quot; + $sys.idSelected );&#xA;$db.executeSql(&quot;DELETE FROM WF_CTPROCESO WHERE Id =&quot; + $sys.idSelected);&#xA;&#xA;$db.executeSql(&quot;DELETE FROM WF_CTFASE WHERE Catalog_Proceso =&quot; + $sys.idSelected);" orden="0" asincrono="1" />
        </campo>
      </bloque>
    </bloque>
  </tab>
</form>