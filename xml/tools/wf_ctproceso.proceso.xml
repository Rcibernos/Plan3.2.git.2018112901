<form id="wf_ctproceso.proceso" tablaanexa="WF_CTPROCESO" nbcampoid="ID" nombreexterno="proceso" nbbtablaoriginal="" ayuda="" sqlcamposvista="SELECT WF_CTPROCESO.Id,&#xD;dbo.PonerPuntuacionNumericaEntera(WF_CTPROCESO.Id) AS [Id|id],WF_CTPROCESO.Nombre AS [Nombre|Nombre],&#xD;dbo.PonerSiNo(WF_CTPROCESO.Activo) AS [Activo|Activo],dbo.PonerSiNo(WF_CTPROCESO.Publico) AS [Publico|Publico],&#xD;replace(replace('[%id%] %TITULO%','%id%',Fase_inicial_TB.id),'%TITULO%',Fase_inicial_TB.texto) AS [Fase_inicial|Fase_Inicial],&#xD;Padre_TB.Nombre AS [Padre|¬Proceso Padre (Para Subprocesos)]&#xD; FROM WF_CTPROCESO&#xD;LEFT OUTER JOIN WF_CTFASE Fase_inicial_TB ON WF_CTPROCESO.Fase_inicial=Fase_inicial_TB.Id&#xD;LEFT OUTER JOIN WF_CTPROCESO Padre_TB ON WF_CTPROCESO.Padre=Padre_TB.Id&#xD; WHERE WF_CTPROCESO.Id=" dynaplantilla="" triggeralter="" estilo="" modocalculo="" nombrepadreid="NOSEUSA" omitirpadreid="1" condiferencias="0" ncol="" version="3">
  <pa id="wf_ctproceso.proceso|responsive" padreid="wf_ctproceso.proceso" nombre="responsive" valor="1" sql="" />
  <pa id="wf_ctproceso.proceso|responsivestatus" padreid="wf_ctproceso.proceso" nombre="responsivestatus" valor="rev2pa" sql="" />
  <tab catalogformulariodesigner="wf_ctproceso.proceso" id="1982" titulo="general" cssclass="" orden="0">
    <calculo padreid="1982" tipo="3" calculo="/*[type=jscript]*/&#xD;&#xA;$this.staticTab=true;" />
    <calculo padreid="1982" tipo="3" calculo="/*[type=jscript]*/&#xD;&#xA;$this.staticTab=true;" />
    <bloque catalogformulariodesigner="wf_ctproceso.proceso" id="2033" titulo="" cssclass="" ncol="12" primeroenlinea="0" padre="1982" visible="1" orden="1">
      <bloque catalogformulariodesigner="wf_ctproceso.proceso" id="2087" titulo="" cssclass="" ncol="12" primeroenlinea="0" padre="2033" visible="1" orden="1">
        <campo id="wf_ctproceso.proceso|id" tipo="2" titulo="id" campo="ID" visible="1" sololectura="1" obligatorio="0" ancho="0" ayuda="" alto="20" etiqueta="2" tipomacro="2" orden="1" ncol="1" primeroenlinea="1" />
        <campo id="wf_ctproceso.proceso|nombre" tipo="1" titulo="Nombre" campo="NOMBRE" visible="1" sololectura="0" obligatorio="1" ancho="0" ayuda="¬Nombre del proceso" alto="20" etiqueta="2" longitud="50" password="" multilinea="0" tipomacro="1" orden="2" ncol="3" primeroenlinea="0">
          <pa padreid="wf_ctproceso.proceso|nombre" nombre="placeholder" valor="¬--Nombre del proceso--" sql="" />
        </campo>
        <campo id="wf_ctproceso.proceso|padre" tipo="1274" titulo="¬Proceso Padre (Para Subprocesos)" campo="PADRE" visible="1" sololectura="0" obligatorio="0" ancho="0" ayuda="" alto="20" etiqueta="2" tipomacro="-1" orden="3" ncol="3" primeroenlinea="0">
          <tipocampo id="1274" nombre="*Selector Proceso Padre" catalogtipocontrol="3" padre="" tiposql="int" tipopgs="Combo" vinculada="0" nbtabla="WF_CTPROCESO" nbcampoid="ID" nbcampotitulo="WF_CTPROCESO.NOMBRE" sqlinit="/*[type=SQL]*/&#xD;&#xA;SELECT ID,NOMBRE AS TITULO FROM WF_CTPROCESO &#xD;&#xA;WHERE ID NOT IN([@PGS!Sys.IdForm])&#xD;&#xA;ORDER BY NOMBRE" sqlinithijo="" sqlleerregistro="" tiposcondicion="=!" formulasqlcamposvista="" sistema="0" valoresfijos="0" campoid="" campotitulo="" />
          <pa id="wf_ctproceso.proceso|padre|selector_abierto" padreid="wf_ctproceso.proceso|padre" propiedad="selector_abierto" valor="" />
        </campo>
        <campo id="wf_ctproceso.proceso|fase_inicial" tipo="1273" titulo="Fase_Inicial" campo="FASE_INICIAL" visible="1" sololectura="0" obligatorio="0" ancho="0" ayuda="" alto="20" etiqueta="2" tipomacro="-1" orden="4" ncol="2" primeroenlinea="0">
          <tipocampo id="1273" nombre="*Todas las Fases X Proceso" catalogtipocontrol="3" padre="" tiposql="int" tipopgs="Combo" vinculada="0" nbtabla="WF_CTFASE" nbcampoid="ID" nbcampotitulo="REPLACE(REPLACE('[%ID%] %TITULO%','%ID%',CAST(WF_CTFASE.ID AS VARCHAR(200))),'%TITULO%',WF_CTFASE.TEXTO)" sqlinit="/*[type=sql]*/&#xD;&#xA;SELECT ID,replace(replace('[%id%] %TITULO%','%id%',CAST(WF_CTFASE.id AS varchar(200))),'%TITULO%',WF_CTFASE.texto) AS TITULO &#xD;&#xA;FROM WF_CTFASE &#xD;&#xA;WHERE WF_CTFASE.Catalog_Proceso=[@PGS!Sys.IdForm]&#xD;&#xA;ORDER BY WF_CTFASE.Nivel, WF_CTFASE.texto" sqlinithijo="" sqlleerregistro="" tiposcondicion="=!" formulasqlcamposvista="" sistema="0" valoresfijos="0" campoid="" campotitulo="" />
          <pa id="wf_ctproceso.proceso|fase_inicial|selector_abierto" padreid="wf_ctproceso.proceso|fase_inicial" propiedad="selector_abierto" valor="" />
          <calculo padreid="wf_ctproceso.proceso|fase_inicial" tipo="1" bdtipo="1" calculo="/*[type=jscript]*/&#xA;if (!$sys.idForm) { $this.required=false; return;}&#xA;var c=$sys.db.count(&quot;WF_CTFASE&quot;,&quot;ID&quot;,&quot;WHERE catalog_proceso=&quot;+$sys.idForm);&#xA;if (c==0) {$this.required=false; return;}&#xA;if (c==1) {&#xA;    $this.value=$sys.db.executeSql(&quot;SELECT MAX(ID) FROM WF_CTFASE WHERE catalog_proceso=&quot;+$sys.idForm).getValue(0,0)&#xA;}&#xA;//Cualquier otro caso.&#xA;$this.required=true;" orden="0" asincrono="1" />
        </campo>
        <campo id="wf_ctproceso.proceso|activo" tipo="11" titulo="Activo" campo="ACTIVO" visible="1" sololectura="0" obligatorio="0" ancho="0" ayuda="" alto="20" etiqueta="2" tipomacro="11" orden="5" ncol="1" primeroenlinea="0">
          <calculo padreid="wf_ctproceso.proceso|activo" tipo="1" bdtipo="3" calculo="/*[type=jscript]*/ &#xA;if ($this.value==null)&#xA;{$this.value=true;}" orden="0" asincrono="1" />
        </campo>
        <campo id="wf_ctproceso.proceso|publico" tipo="11" titulo="Publico" campo="PUBLICO" visible="1" sololectura="0" obligatorio="0" ancho="0" ayuda="" alto="20" etiqueta="2" tipomacro="11" orden="6" ncol="1" primeroenlinea="0">
          <calculo padreid="wf_ctproceso.proceso|publico" tipo="1" bdtipo="3" calculo="/*[type=jscript]*/ &#xA;if ($this.value==null)&#xA;{$this.value=true;}" orden="0" asincrono="1" />
        </campo>
      </bloque>
    </bloque>
  </tab>
  <tab catalogformulariodesigner="wf_ctproceso.proceso" id="2245" titulo="¬Gráfico" cssclass="" orden="1">
    <bloque catalogformulariodesigner="wf_ctproceso.proceso" id="2246" titulo="" cssclass="" ncol="12" primeroenlinea="1" padre="2245" visible="1" orden="1">
      <campo id="wf_ctproceso.proceso|diagrama" tipo="28" titulo="¬Diagrama" campo="DIAGRAMA" visible="1" sololectura="0" obligatorio="0" ancho="0" ayuda="" alto="655" etiqueta="2" tipomacro="28" orden="1" ncol="12" primeroenlinea="0" />
    </bloque>
  </tab>
  <tab catalogformulariodesigner="wf_ctproceso.proceso" id="1996" titulo="¬Todas las fases" cssclass="" orden="2">
    <bloque catalogformulariodesigner="wf_ctproceso.proceso" id="2034" titulo="" cssclass="" ncol="12" primeroenlinea="0" padre="1996" visible="1" orden="1">
      <campo id="wf_ctproceso.proceso|fases" tipo="106" titulo="¬Todas las Fases" campo="FASES" visible="1" sololectura="8" obligatorio="0" ancho="0" ayuda="" alto="799" etiqueta="2" tabla="WF_CTFASE" formulario_edicion="wf_ctfase.fasesxproceso" alto_formulario="0" ancho_formulario="0" limite_registros="25" formulario_columnas="wf_ctfase.fasesxprocesocol" con_bajas="0" modo_seleccion="0" contador_de_registros="0" exportar_a_excel="0" nivel_de_agrupacion="0" tamano_de_pagina="" modo_visualizar_formulario_emergente="1" modo_insercion_nuevos_registros="0" expandir_a_lo_alto="0" procedimiento_formulario_asincrono="" paginar_ver_todos="1" validar_grid_encambio_de_pagina="1" condicion="/*[type=SQL]*/&#xD;&#xA;WHERE WF_CTFASE.Catalog_Proceso=[%IdEnEjecucion%]" orderby="ORDER BY wf_ctfase.nivel, wf_ctfase.y, wf_ctfase.x, wf_ctfase.texto" accion_al_editar="/*[type=jscript]*/ &#xA;if ($db.type==&quot;oracle&quot;)&#xA;{ $this.PGS(&quot;openform&quot;,[&quot;wf_ctfase.fasesxprocesoo&quot;,$sys.idSelected,1,1]);}" tipomacro="106" orden="1" ncol="12" primeroenlinea="1">
        <pa padreid="wf_ctproceso.proceso|fases" nombre="count_reg_txt" valor="¬Fases" sql="" />
        <pa padreid="wf_ctproceso.proceso|fases" nombre="del_reg_ok" valor="¬Se ha borrado la fase" sql="" />
        <pa padreid="wf_ctproceso.proceso|fases" nombre="del_reg_tooltip" valor="¬Borrar la fase" sql="" />
        <pa padreid="wf_ctproceso.proceso|fases" nombre="del_reg_txt_confirm" valor="¬Se va a borrar la fase ¿Está de acuerdo?" sql="" />
        <pa padreid="wf_ctproceso.proceso|fases" nombre="new_reg_tooltip" valor="¬Nueva fase" sql="" />
        <pa padreid="wf_ctproceso.proceso|fases" nombre="new_reg_txt" valor="¬Nueva fase" sql="" />
        <pa padreid="wf_ctproceso.proceso|fases" nombre="no_filas_txt" valor="¬Este proceso no tiene ninguna fase" sql="" />
        <calculo padreid="wf_ctproceso.proceso|fases" tipo="102" bdtipo="102" calculo="/*[type=jscript]*/ &#xA;&#xA;$sys.trace('Id de la fase (idSelected): ' + $sys.idSelected);&#xA;&#xA;//No borra la fase inicial de un proceso&#xA;var faseInicial = $db.count('WF_CATALOGPROCESO','*','Fase_Inicial =' + $sys.idSelected);&#xA;&#xA;//Cuenta las fases del proceso &#xA;var fases = $db.count('WF_CTFASE','*','CATALOG_PROCESO =' + $sys.padreId);&#xA;&#xA;//No borra las fases que tengan bifurcaciones de salida&#xA;var BifSalida = $db.count('WF_CTRESPUESTA','Id','Catalog_Fase_Origen =' + $sys.idSelected);&#xA;&#xA;//No borrar las fases que tengan bifurcaciones de entrada&#xA;var BifEntrada = $db.count('WF_CTRESPUESTA','Id','Catalog_Fase_Destino =' + $sys.idSelected);&#xA;&#xA;//No borrar las fases que estén como faseactual de un proceso&#xA;var FaseActualProceso = $db.count('WF_HistorialProceso','Id','Catalog_Fase = ' + $sys.idSelected + ' AND Catalog_Respuesta IS NULL');&#xA;&#xA;//No borrar las fases que ya estén en historialproceso&#xA;var FaseEnHistorial = $db.count('WF_HistorialProceso','Id','Catalog_Fase =' + $sys.idSelected);&#xA;&#xA;if (faseInicial &gt; 0 &amp;&amp; fases &gt; 1) {&#xA;    $this.err = 'No se puede borrar la fase inicial de un proceso'; &#xA;    //Salvo que sea la única&#xA;    return;&#xA;} else if (BifSalida == 1) {&#xA;    $this.err = 'La fase aún contiene una bifurcación de salida';&#xA;    return;&#xA;} else if (BifSalida &gt; 1) {&#xA;    $this.err = 'La fase aún contiene varias bifurcaciones de salida';&#xA;    return;&#xA;} else if(BifEntrada == 1) {&#xA;    $this.err = 'La fase aún contiene una bifurcación de entrada';&#xA;    return;&#xA;} else if(BifEntrada &gt; 1) {&#xA;    $this.err = 'La fase aún contiene varias bifurcaciones de entrada';&#xA;    return;&#xA;} else if(FaseActualProceso &gt;= 1) {&#xA;    $this.err = 'La fase se encuentra entre las fases actuales del proceso';&#xA;    return;&#xA;} else if(FaseEnHistorial &gt;= 1) {&#xA;    $this.err = 'La fase ya está guardada en el historial del proceso';&#xA;    return;&#xA;}&#xA;&#xA;if (faseInicial &gt; 0 &amp;&amp; fases &lt;= 1){&#xA;$db.executeCommand(&quot;UPDATE WF_CTPROCESO set FASE_INICIAL=null WHERE id=&quot; + $sys.padreId);&#xA;}" orden="0" asincrono="1" />
      </campo>
    </bloque>
  </tab>
  <tab catalogformulariodesigner="wf_ctproceso.proceso" id="1997" titulo="¬Todas las bifurcaciones" cssclass="" orden="3">
    <bloque catalogformulariodesigner="wf_ctproceso.proceso" id="2035" titulo="" cssclass="" ncol="12" primeroenlinea="0" padre="1997" visible="1" orden="1">
      <campo id="wf_ctproceso.proceso|bifurcaciones" tipo="106" titulo="¬Todas las bifurcaciones" campo="BIFURCACIONES" visible="1" sololectura="1" obligatorio="0" ancho="0" ayuda="" alto="812" etiqueta="2" tabla="WF_CTRESPUESTA" formulario_edicion="wf_ctrespuesta.bifsxproceso" alto_formulario="0" ancho_formulario="0" limite_registros="25" formulario_columnas="wf_ctrespuesta.bifsxproceso" con_bajas="0" modo_seleccion="0" contador_de_registros="1" exportar_a_excel="0" nivel_de_agrupacion="0" tamano_de_pagina="" modo_visualizar_formulario_emergente="1" modo_insercion_nuevos_registros="1" expandir_a_lo_alto="1" procedimiento_formulario_asincrono="" paginar_ver_todos="1" validar_grid_encambio_de_pagina="1" condicion="/*[type=SQL]*/&#xD;&#xA;WHERE WF_CTRESPUESTA.Catalog_Fase_Origen IN (SELECT id FROM WF_CTFASE WHERE Catalog_Proceso=[%IdEnEjecucion%])&#xD;&#xA;OR  WF_CTRESPUESTA.Catalog_Fase_Destino IN (SELECT id FROM WF_CTFASE WHERE Catalog_Proceso=[%IdEnEjecucion%])&#xD;&#xA;" orderby="ORDER BY WF_CTRESPUESTA.Y, WF_CTRESPUESTA.x, WF_CTRESPUESTA.Texto" accion_al_editar="" tipomacro="106" orden="1" ncol="12" primeroenlinea="1">
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="count_reg_txt" valor="¬Bifurcaciones" sql="" />
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="del_reg_ok" valor="¬Se ha borrado la bifurcación" sql="" />
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="del_reg_tooltip" valor="¬Borrar la bifurcación" sql="" />
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="del_reg_txt_confirm" valor="¬Se va a eliminar la bifurcación. ¿Está de acuerdo?" sql="" />
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="new_reg_tooltip" valor="¬Nueva bifurcación" sql="" />
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="new_reg_txt" valor="¬Nueva bifurcación" sql="" />
        <pa padreid="wf_ctproceso.proceso|bifurcaciones" nombre="no_filas_txt" valor="¬No hay bifurcaciones" sql="" />
      </campo>
    </bloque>
  </tab>
  <calculo id="wf_ctproceso.proceso|wf_ctproceso.proceso|209" padreid="wf_ctproceso.proceso" tipo="209" calculo="/*[type=jscript]*/ &#xA;var i = $sys.idForm;&#xA;var createSQL =&quot;&quot;;&#xA;var createConstraint=&quot;&quot;;&#xA;var createFIni = &quot;INSERT INTO WF_CTFASE (Texto,Tipo_Rol,Nivel,EsFinal,Catalog_Proceso,x,y,Ancho,Alto,condiferencias,ModoValidacion,MomentoValidacion) VALUES ('¬Inicio',1,0,0,&quot;+ i +&quot;,4000,300,1500,650,0,0,0)&quot;;&#xA;var setFIni =&quot;UPDATE WF_CTPROCESO set FASE_INICIAL=(SELECT MIN(ID) FROM WF_CTFASE WHERE Catalog_Proceso=&quot; + i+&quot;) WHERE ID=&quot; + i;&#xA;&#xA;if ($db.type==&quot;oracle&quot;){&#xA; createSQL =&quot;CREATE TABLE WF_PROCESO_&quot; + i + &quot;(AGENDA NUMERIC(10,0) NOT NULL,&quot; +&#xA; &quot; CONSTRAINT PK_WF_PROCESO_&quot; +i+ &quot; PRIMARY KEY (Agenda))&quot;;&#xA; createConstraint=&quot;ALTER TABLE WF_PROCESO_&quot;+ i +&quot; ADD CONSTRAINT FK_WF_PROCESO_&quot; +i+ &quot;_AG FOREIGN KEY(AGENDA) REFERENCES AGENDA (Id)&quot;; &#xA;}&#xA;else if ($db.type==&quot;postgresql&quot;){&#xA; createSQL =&quot;CREATE TABLE WF_PROCESO_&quot; + i + &quot;(AGENDA bigint NOT NULL,&quot; +&#xA; &quot; CONSTRAINT PK_WF_PROCESO_&quot; +i+ &quot; PRIMARY KEY (Agenda))&quot;;&#xA; &#xA; createConstraint=&quot;ALTER TABLE WF_PROCESO_&quot;+ i +&quot; ADD CONSTRAINT FK_WF_PROCESO_&quot; +i+ &quot;_AG FOREIGN KEY(AGENDA) REFERENCES AGENDA (Id)&quot;;    &#xA;}&#xA;else{&#xA; createSQL =&quot;CREATE TABLE dbo.WF_Proceso_&quot; + i + &quot;(Agenda int NOT NULL,&quot; +&#xA; &quot; CONSTRAINT PK_WF_Proceso_&quot; +i+ &quot; PRIMARY KEY CLUSTERED (Agenda ASC))&quot;;&#xA; &#xA; createConstraint=&quot;ALTER TABLE dbo.WF_Proceso_&quot;+ i +&quot; WITH CHECK ADD  CONSTRAINT FK_WF_Proceso_&quot; +i+ &quot;_AG FOREIGN KEY(Agenda) REFERENCES Agenda (Id)&quot;;&#xA;}&#xA;$db.executeCommand(createSQL);&#xA;$db.executeCommand(createConstraint);&#xA;$db.executeCommand(createFIni);&#xA;$db.executeCommand(setFIni);" orden="0" asincrono="1" />
  <campo id="wf_ctproceso.proceso|tiempocaducidad" tipo="1" titulo="TiempoCaducidad" campo="TIEMPOCADUCIDAD" visible="1" sololectura="1" obligatorio="0" ancho="0" ayuda="" alto="30" etiqueta="2" longitud="12" password="" multilinea="0" tipomacro="1" orden="4" ncol="3" primeroenlinea="0" />
</form>